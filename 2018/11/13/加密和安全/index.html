<!DOCTYPE html>



  



<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="模块,加密,openssl,ssh,CA,">





  <link rel="alternate" href="/atom.xml" title="Linux知识库" type="application/atom+xml">






<meta name="description" content="对称加密算法对称加密 加密和解密使用同一个密钥特性：  加密、解密使用同一个密钥，效率高将原始数据分割成固定大小的块，逐个进行加密  缺陷：  密钥过多密钥分发数据来源无法确认  非对称加密算法公钥加密:密钥是成对出现1234[root@cetos7 ~]#cd /etc/ssh[root@cetos7 ssh]#ll-rw-r-----. 1 root ssh_keys   1679 Sep 2">
<meta name="keywords" content="模块,加密,openssl,ssh,CA">
<meta property="og:type" content="article">
<meta property="og:title" content="加密和安全">
<meta property="og:url" content="http://yoursite.com/2018/11/13/加密和安全/index.html">
<meta property="og:site_name" content="Linux知识库">
<meta property="og:description" content="对称加密算法对称加密 加密和解密使用同一个密钥特性：  加密、解密使用同一个密钥，效率高将原始数据分割成固定大小的块，逐个进行加密  缺陷：  密钥过多密钥分发数据来源无法确认  非对称加密算法公钥加密:密钥是成对出现1234[root@cetos7 ~]#cd /etc/ssh[root@cetos7 ssh]#ll-rw-r-----. 1 root ssh_keys   1679 Sep 2">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://github.com/xiejia1215225/Pictures/blob/master/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png?raw=true">
<meta property="og:image" content="https://github.com/xiejia1215225/Pictures/blob/master/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png?raw=true">
<meta property="og:image" content="https://github.com/xiejia1215225/Pictures/blob/master/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D.png?raw=true">
<meta property="og:image" content="https://github.com/xiejia1215225/Pictures/blob/master/%E5%8D%95%E5%90%91%E6%95%A3%E5%88%97.png?raw=true">
<meta property="og:image" content="https://github.com/xiejia1215225/Pictures/blob/master/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.png?raw=true">
<meta property="og:image" content="https://github.com/xiejia1215225/Pictures/blob/master/SSL%E5%92%8CTLS.png?raw=true">
<meta property="og:image" content="https://github.com/xiejia1215225/Pictures/blob/master/PAM%E6%9E%B6%E6%9E%84.png?raw=true">
<meta property="og:updated_time" content="2019-01-24T09:10:41.115Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="加密和安全">
<meta name="twitter:description" content="对称加密算法对称加密 加密和解密使用同一个密钥特性：  加密、解密使用同一个密钥，效率高将原始数据分割成固定大小的块，逐个进行加密  缺陷：  密钥过多密钥分发数据来源无法确认  非对称加密算法公钥加密:密钥是成对出现1234[root@cetos7 ~]#cd /etc/ssh[root@cetos7 ssh]#ll-rw-r-----. 1 root ssh_keys   1679 Sep 2">
<meta name="twitter:image" content="https://github.com/xiejia1215225/Pictures/blob/master/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png?raw=true">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/13/加密和安全/">



<script>(function(T,h,i,n,k,P,a,g,e){g=function(){P=h.createElement(i);a=h.getElementsByTagName(i)[0];P.src=k;P.charset="utf-8";P.async=1;a.parentNode.insertBefore(P,a)};T["ThinkPageWeatherWidgetObject"]=n;T[n]||(T[n]=function(){(T[n].q=T[n].q||[]).push(arguments)});T[n].l=+new Date();if(T.attachEvent){T.attachEvent("onload",g)}else{T.addEventListener("load",g,false)}}(window,document,"script","tpwidget","//widget.seniverse.com/widget/chameleon.js"))</script>
<script>tpwidget("init", {
    "flavor": "bubble",
    "location": "WTW3SJ5ZBJUY",
    "geolocation": "enabled",
    "position": "top-left",
    "margin": "10px 10px",
    "language": "zh-chs",
    "unit": "c",
    "theme": "chameleon",
    "uid": "U4F2547B10",
    "hash": "d49c6de3fe37062a9b1db42177056f08"
});
tpwidget("show");</script>

  <title>加密和安全 | Linux知识库</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	
	<a href="https://github.com/xiejia1215225"><img style="position: absolute; top: 0; right: 0; border: 0
	;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Linux知识库</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/13/加密和安全/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="谢 佳">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux知识库">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">加密和安全</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-13T00:00:00+08:00">
                2018-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/安全/" itemprop="url" rel="index">
                    <span itemprop="name">安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  8.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  35
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h1><h2 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h2><p><img src="https://github.com/xiejia1215225/Pictures/blob/master/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png?raw=true" alt="img"></p>
<p>加密和解密使用同一个密钥<br>特性：</p>
<blockquote>
<p>加密、解密使用同一个密钥，效率高<br>将原始数据分割成固定大小的块，逐个进行加密</p>
</blockquote>
<p>缺陷：</p>
<blockquote>
<p>密钥过多<br>密钥分发<br>数据来源无法确认</p>
</blockquote>
<h1 id="非对称加密算法"><a href="#非对称加密算法" class="headerlink" title="非对称加密算法"></a>非对称加密算法</h1><h2 id="公钥加密-密钥是成对出现"><a href="#公钥加密-密钥是成对出现" class="headerlink" title="公钥加密:密钥是成对出现"></a>公钥加密:密钥是成对出现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@cetos7 ~]#cd /etc/ssh</span><br><span class="line">[root@cetos7 ssh]#ll</span><br><span class="line">-rw-r-----. 1 root ssh_keys   1679 Sep 25 11:01 ssh_host_rsa_key</span><br><span class="line">-rw-r--r--. 1 root root        382 Sep 25 11:01 ssh_host_rsa_key.pub</span><br></pre></td></tr></table></figure>
<blockquote>
<p>公钥：公开给所有人；public key<br>私钥：自己留存，必须保证其私密性；secret key</p>
</blockquote>
<p>特点：用公钥加密数据，只能使用与之配对的私钥解密；反之亦然</p>
<p>功能：</p>
<blockquote>
<p>数字签名：主要在于让接收方确认发送方身份<br>对称密钥交换：发送方用对方的公钥加密一个对称密钥后发送给对方<br>数据加密：适合加密较小数据</p>
</blockquote>
<p>缺点：密钥长，加密解密效率低下</p>
<h2 id="非对称加密-基于一对公钥-密钥对"><a href="#非对称加密-基于一对公钥-密钥对" class="headerlink" title="非对称加密:基于一对公钥/密钥对"></a>非对称加密:基于一对公钥/密钥对</h2><p><img src="https://github.com/xiejia1215225/Pictures/blob/master/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86.png?raw=true" alt="img"><br>用密钥对中的一个加密，另一个解密</p>
<ol>
<li><p>实现加密：</p>
<blockquote>
<p>接收者生成公钥/密钥对：P和S ;公开公钥P，保密密钥S<br>发送者使用接收者的公钥来加密消息M ;将P(M)发送给接收者<br>接收者使用密钥S来解密：M=S(P(M))</p>
</blockquote>
</li>
<li><p>实现数字签名</p>
<blockquote>
<p>发送者生成公钥/密钥对：P和S ;公开公钥P，保密密钥S ;使用密钥S来加密消息M ;发送给接收者S(M)<br>接收者使用发送者的公钥来解密M=P(S(M))</p>
</blockquote>
</li>
</ol>
<p>数字签名<br><img src="https://github.com/xiejia1215225/Pictures/blob/master/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D.png?raw=true" alt="数字签名"></p>
<ol>
<li>结合签名和加密</li>
<li>分离签名</li>
</ol>
<h1 id="单向散列-数字指纹"><a href="#单向散列-数字指纹" class="headerlink" title="单向散列(数字指纹)"></a>单向散列(数字指纹)</h1><p><img src="https://github.com/xiejia1215225/Pictures/blob/master/%E5%8D%95%E5%90%91%E6%95%A3%E5%88%97.png?raw=true" alt="img"></p>
<ol>
<li><p>将任意数据缩小成固定大小的“指纹”</p>
<blockquote>
<p>任意长度输入<br>固定长度输出<br>若修改数据，指纹也会改变（“不会产生冲突”）<br>无法从指纹中重新生成数据（“单向”）</p>
</blockquote>
</li>
<li><p>功能：数据完整性</p>
</li>
<li><p>常见算法<br> md5: 128bits、<br> sha1: 160bits、 sha224、sha256、 sha384、 sha512</p>
</li>
<li><p>常用工具</p>
<blockquote>
<p>md5sum | sha1sum [ –check ] file<br>openssl、 gpg<br>rpm -V</p>
</blockquote>
</li>
</ol>
<p>加密类型对比</p>
<table>
<thead>
<tr>
<th></th>
<th><code>加密速度</code></th>
<th><code>密钥数</code></th>
<th><code>分发难度</code></th>
<th><code>密钥安全性</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>对称加密</td>
<td>中</td>
<td>多</td>
<td>难，方式很多，很混乱</td>
<td>安全机制很不健全</td>
</tr>
<tr>
<td>单向加密</td>
<td>快</td>
<td>无</td>
<td>最简单，官网公布</td>
<td>不需要安全性</td>
</tr>
<tr>
<td>非对称加密</td>
<td>慢</td>
<td>少</td>
<td>中，通过CA分发</td>
<td>有健全的安全机制</td>
</tr>
</tbody>
</table>
<h1 id="密钥交换"><a href="#密钥交换" class="headerlink" title="密钥交换"></a>密钥交换</h1><p>密钥交换：IKE（ Internet Key Exchange ）</p>
<blockquote>
<p>公钥加密<br>DH (Deffie-Hellman)：生成会话密钥，</p>
<blockquote>
<p>DH</p>
<blockquote>
<p>A: g,p 协商生成公开的整数g, 大素数p<br>B: g,p<br>A:生成隐私数据 :a (a&lt;p )，计算得出 g^a%p，发送给B<br>B:生成隐私数据 :b,计算得出 g^b%p，发送给A<br>A:计算得出 [(g^b%p)^a] %p = g^ab%p，生成为密钥<br>B:计算得出 [(g^a%p)^b] %p = g^ab%p，生成为密钥</p>
</blockquote>
</blockquote>
</blockquote>
<h1 id="使用gpg实现对称加密"><a href="#使用gpg实现对称加密" class="headerlink" title="使用gpg实现对称加密"></a>使用gpg实现对称加密</h1><ol>
<li><p>对称加密file文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg -c filename</span><br><span class="line">ls filename.gpg</span><br></pre></td></tr></table></figure>
</li>
<li><p>在另一台主机上解密filename</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg -o file -d filename.gpg</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="使用gpg工具实现公钥加密"><a href="#使用gpg工具实现公钥加密" class="headerlink" title="使用gpg工具实现公钥加密"></a>使用gpg工具实现公钥加密</h1><p>在hostB主机上用公钥加密，在hostA主机上解密</p>
<ol>
<li><p>在hostA主机上生成公钥/私钥对</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg –gen-key</span><br></pre></td></tr></table></figure>
</li>
<li><p>在hostA主机上查看公钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg –list-keys</span><br></pre></td></tr></table></figure>
</li>
<li><p>在hostA主机上导出公钥到/data/magedupubkey</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg -a –<span class="built_in">export</span> -o /data/magedupubkey</span><br></pre></td></tr></table></figure>
</li>
<li><p>从hostA主机上复制公钥文件到需加密的B主机上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp magedupubkey hostB:</span><br></pre></td></tr></table></figure>
</li>
<li><p>在需加密数据的hostB主机上生成公钥/私钥对</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg –list-keys</span><br><span class="line">gpg –gen-key</span><br></pre></td></tr></table></figure>
</li>
<li><p>在hostB主机上导入公钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg –import magedupubkey</span><br><span class="line">gpg –list-keys</span><br></pre></td></tr></table></figure>
</li>
<li><p>用从hostA主机导入的公钥，加密hostB主机的文件file,生成file.gpg</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg -e -r magedu f1.txt</span><br><span class="line">f1.txt.gpg</span><br></pre></td></tr></table></figure>
</li>
<li><p>复制加密文件到hostA主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp f1.txt.gpg hostA:</span><br></pre></td></tr></table></figure>
</li>
<li><p>在hostA主机解密文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpg -o f1.txt -d f1.txt.gpg</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除公钥和私钥(先删除私钥再删公钥)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg –delete-secret-keys wange</span><br><span class="line">gpg –delete-keys wange</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h1><p><img src="https://github.com/xiejia1215225/Pictures/blob/master/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.png?raw=true" alt="img"></p>
<h1 id="CA和证书"><a href="#CA和证书" class="headerlink" title="CA和证书"></a>CA和证书</h1><p>PKI: Public Key Infrastructure</p>
<blockquote>
<p>签证机构：CA（Certificate Authority）<br>注册机构：RA<br>证书吊销列表：CRL<br>证书存取库：</p>
</blockquote>
<h2 id="证书获取"><a href="#证书获取" class="headerlink" title="证书获取"></a>证书获取</h2><p>证书类型：</p>
<blockquote>
<p>证书授权机构的证书<br>服务器<br>用户证书<br>获取证书两种方法：</p>
<ol>
<li>使用证书授权机构<br> 生成证书请求（csr）<br> 将证书请求csr发送给CA<br> CA签名颁发证书</li>
<li>自签名的证书<br> 自已签发自己的公钥</li>
</ol>
</blockquote>
<h1 id="安全协议"><a href="#安全协议" class="headerlink" title="安全协议"></a>安全协议</h1><h2 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h2><p>功能：机密性，认证，完整性，重放保护<br>两阶段协议，分为握手阶段和应用阶段</p>
<ol>
<li><p>握手阶段(协商阶段):客户端和服务器端认证对方身份（依赖于PKI体系，利用数字证书进行身份认证），并协商通信中使用的安全参数、密码套件以及主密钥。 后续通信使用的所有密钥都是通过MasterSecret生成。</p>
</li>
<li><p>应用阶段:在握手阶段完成后进入，在应用阶段通信双方使用握手阶段协商好的密钥进行安全通信</p>
</li>
</ol>
<h2 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL/TLS"></a>SSL/TLS</h2><p><img src="https://github.com/xiejia1215225/Pictures/blob/master/SSL%E5%92%8CTLS.png?raw=true" alt="SSL和TLS.png"></p>
<ul>
<li>Handshake协议：包括协商安全参数和密码套件、服务器身份认证（客户端身份认证可选）、密钥交换</li>
<li>ChangeCipherSpec 协议：一条消息表明握手协议已经完成</li>
<li>Alert 协议：对握手协议中一些异常的错误提醒，分为fatal和warning两个级别，fatal类型错误会直接中断SSL链接，而warning级别的错误SSL链接仍可继续，只是会给出错误警告</li>
<li>Record 协议：包括对消息的分段、压缩、消息认证和完整性保护、加密等</li>
<li>HTTPS 协议：就是“HTTP 协议”和“SSL/TLS 协议”的组合。 HTTP overSSL” 或“HTTP over TLS” ，对http协议的文本数据进行加密处理后，成为二进制形式传输</li>
</ul>
<h1 id="openssl命令"><a href="#openssl命令" class="headerlink" title="openssl命令"></a>openssl命令</h1><p>两种运行模式：交互模式和批处理模式<br>openssl version：程序版本号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@cetos7 ~]<span class="comment">#openssl version</span></span><br><span class="line">OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></pre></td></tr></table></figure>
<ol>
<li><p>对称加密：</p>
<p>工具：openssl enc, gpg</p>
<p>算法：3des, aes, blowfish, twofish</p>
<blockquote>
<p>enc命令<br>加密：<br>openssl enc -e -des3 -a -salt -in filename -out filename.enc<br>解密：<br>openssl enc -d -des3 -a -salt –in filename.enc -out filename</p>
</blockquote>
</li>
<li><p>单向加密：</p>
<p>工具：md5sum, sha1sum, sha224sum,sha256sum…</p>
<blockquote>
<p>dgst命令：<br>openssl dgst -md5 [-hex默认] filename<br>md5sum filename</p>
</blockquote>
</li>
<li><p>生成用户密码<br> passwd命令:<br> openssl passwd -1<br> openssl passwd -1 -salt “SALT(最多8位)”</p>
</li>
<li><p>生成随机数<br> openssl rand -base64|-hex NUM<br> NUM: 表示字节数,使用-hex,每个字符为十六进制,相当于4位二进制,出现的字符数为NUM*2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@cetos7 ~]<span class="comment">#openssl rand -base64 3</span></span><br><span class="line">n5c0</span><br><span class="line">[root@cetos7 ~]<span class="comment">#openssl rand -hex 3</span></span><br><span class="line">a8e1d2</span><br></pre></td></tr></table></figure>
</li>
<li><p>公钥加密<br> 算法：RSA, ELGamal<br> 工具：gpg, openssl rsautl（man rsautl）</p>
</li>
<li><p>数字签名<br> 算法：RSA, DSA, ELGamal</p>
</li>
<li><p>密钥交换：</p>
<p>算法：dh</p>
<p>生成私钥<br>openssl genrsa -out /PATH/TO/PRIVATEKEY.FILE NUM_BITS</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos~]<span class="comment">#openssl genrsa -out test.key 1024</span></span><br></pre></td></tr></table></figure>
<p>(umask 077; openssl genrsa –out test.key –des 2048) 加密</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos~]<span class="comment">#(umask 077;openssl genrsa -out test.key -des 2048)</span></span><br></pre></td></tr></table></figure>
<p>openssl rsa -in test.key –out test.bak 将加密key解密</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos~]<span class="comment">#openssl rsa -in test.key -out test.bak</span></span><br></pre></td></tr></table></figure>
<p>从私钥中提取出公钥</p>
<blockquote>
<p>openssl rsa –in test.key –pubout –out test.key.pub</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; [root@centos~]<span class="comment">#openssl rsa -in test.key -pubout -out test.key.pub</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>随机数生成器：伪随机数字</p>
<p>  键盘和鼠标，块设备中断</p>
<blockquote>
<p>/dev/random：仅从熵池返回随机数；随机数用尽，阻塞</p>
<blockquote>
<p>/dev/urandom：从熵池返回随机数；随机数用尽，会利用软件生成伪随机数,非阻塞OpenSSL</p>
</blockquote>
</blockquote>
<h1 id="创建CA和申请证书"><a href="#创建CA和申请证书" class="headerlink" title="创建CA和申请证书"></a>创建CA和申请证书</h1><ol>
<li><p>创建所需要的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/pki/CA/index.txt 生成证书索引数据库文件</span><br><span class="line"><span class="built_in">echo</span> 01 &gt; /etc/pki/CA/serial 指定第一个颁发证书的序列号</span><br></pre></td></tr></table></figure>
</li>
<li><p>CA自签证书<br> 生成私钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/pki/CA/</span><br><span class="line">(<span class="built_in">umask</span> 066; openssl genrsa -out private/cakey.pem 2048)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>生成自签名证书</p>
<blockquote>
<p>openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -days 3650 -out /etc/pki/CA/cacert.pem<br>选项说明：<br>-new：生成新证书签署请求<br>-x509：专用于CA生成自签证书<br>-key：生成请求时用到的私钥文件<br>-days n：证书的有效期限<br>-out /PATH/TO/SOMECERTFILE: 证书的保存路径  </p>
</blockquote>
<ol start="3">
<li><p>颁发证书</p>
<p> 在需要使用证书的主机生成证书请求<br> 给web服务器生成私钥<br> ​    (umask 066; openssl genrsa –out /data/test.key 2048)</p>
</li>
</ol>
<p>生成证书申请文件</p>
<blockquote>
<p>openssl req -new -key /data/test.key -out /data/test.csr</p>
</blockquote>
<p>将证书请求文件传输给CA</p>
<p>CA签署证书，并将证书颁发给请求者</p>
<blockquote>
<p>openssl ca -in /tmp/test.csr –out /etc/pki/CA/certs/test.crt -days 100<br>注意：默认要求 国家，省，公司名称三项必须和CA一致创建CA和证书管理</p>
</blockquote>
<p>查看证书中的信息：</p>
<blockquote>
<p>openssl x509 -in /PATH/FROM/CERT_FILE -noout -text|issuer|subject|serial|dates<br>openssl ca -status SERIAL 查看指定编号的证书状态</p>
</blockquote>
<ol start="4">
<li><p>吊销证书</p>
<blockquote>
<p>openssl ca -revoke /etc/pki/CA/newcerts/SERIAL.pem<br>指定第一个吊销证书的编号,注意：第一次更新证书吊销列表前，才需要执行<br>echo 01 &gt; /etc/pki/CA/crlnumber</p>
</blockquote>
</li>
</ol>
<p>更新证书吊销列表</p>
<blockquote>
<p>openssl ca -gencrl -out /etc/pki/CA/crl.pem</p>
</blockquote>
<p>查看crl文件：</p>
<blockquote>
<p>openssl crl -in /etc/pki/CA/crl.pem -noout -text</p>
</blockquote>
<h1 id="SSH-22-tcp"><a href="#SSH-22-tcp" class="headerlink" title="SSH(22/tcp)"></a>SSH(22/tcp)</h1><ol>
<li><p>具体的软件实现：</p>
<blockquote>
<p>OpenSSH: ssh协议的开源实现，CentOS默认安装<br>dropbear：另一个开源实现</p>
</blockquote>
</li>
<li><p>两种方式的用户登录认证：</p>
<blockquote>
<p>基于password<br>基于key</p>
</blockquote>
</li>
<li><p>Openssh软件组成<br> 相关包：<br> openssh<br> openssh-clients<br> openssh-server</p>
</li>
<li><p>工具：<br> 基于C/S结构</p>
<blockquote>
<p>Client: ssh, scp, sftp，slogin<br>Windows客户端:xshell, putty, securecrt, sshsecureshellclient<br>Server: sshd</p>
</blockquote>
</li>
</ol>
<h2 id="ssh客户端"><a href="#ssh客户端" class="headerlink" title="ssh客户端"></a>ssh客户端</h2><ol>
<li>允许实现对远程系统经验证地加密安全访问</li>
<li>当用户远程连接ssh服务器时，会复制ssh服务器/etc/ssh/ssh_host*key.pub（CentOS7默认是ssh_host_ecdsa_key.pub）文件中的公钥到客户机的~./ssh/know_hosts中。下次连接时，会自动匹配相应私钥，不能匹配，将拒绝连接</li>
</ol>
<p>客户端组件：<br>ssh, 配置文件：/etc/ssh/ssh_config<br>Host PATTERN<br>StrictHostKeyChecking no 首次登录不显示检查提示<br>格式：</p>
<p>​    ssh [user@]host [COMMAND]</p>
<p>​    ssh [-l user] host [COMMAND]</p>
<p>常见选项</p>
<p>​    -p port：远程服务器监听的端口<br>​    -b：指定连接的源IP<br>​    -v：调试模式<br>​    -C：压缩方式<br>​    -X：支持x11转发<br>​    -t：强制伪tty分配<br>ssh -t remoteserver1 ssh -t remoteserver2 ssh remoteserver3</p>
<h2 id="ssh服务登录验证方式："><a href="#ssh服务登录验证方式：" class="headerlink" title="ssh服务登录验证方式："></a>ssh服务登录验证方式：</h2><h3 id="基于用户和口令登录验证"><a href="#基于用户和口令登录验证" class="headerlink" title="基于用户和口令登录验证"></a>基于用户和口令登录验证</h3><blockquote>
<p>客户端发起ssh请求，服务器会把自己的公钥发送给用户<br>用户会根据服务器发来的公钥对密码进行加密<br>加密后的信息回传给服务器，服务器用自己的私钥解密，如果密码正确，则用户登录成功</p>
</blockquote>
<h3 id="基于密钥的登录方式"><a href="#基于密钥的登录方式" class="headerlink" title="基于密钥的登录方式"></a>基于密钥的登录方式</h3><blockquote>
<p>首先在客户端生成一对密钥（ssh-keygen）<br>并将客户端的公钥ssh-copy-id 拷贝到服务端<br>当客户端再次发送一个连接请求，包括ip、用户名<br>服务端得到客户端的请求后，会到authorized_keys中查找，如果有响应的IP和用户，就会随机生成一个字符串，例如：magedu<br>服务端将使用客户端拷贝过来的公钥进行加密，然后发送给客户端<br>得到服务端发来的消息后，客户端会使用私钥进行解密，然后将解密后的字符串发送给服务端<br>服务端接受到客户端发来的字符串后，跟之前的字符串进行对比，如果一致，就允许免密码登录</p>
</blockquote>
<p>基于key认证</p>
<ol>
<li><p>在客户端生成密钥对</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa [-P ‘’][-f “~/.ssh/id_rsa”]</span><br></pre></td></tr></table></figure>
</li>
<li><p>把公钥文件传输至远程服务器对应用户的家目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id [-i [identity_file]][user@]host</span><br></pre></td></tr></table></figure>
</li>
<li><p>重设私钥口令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen –p</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证代理（authentication agent）保密解密后的密钥<br>• 这样口令就只需要输入一次<br>• 在GNOME中，代理被自动提供给root用户<br>• 否则运行ssh-agent bash</p>
</li>
<li><p>钥匙通过命令添加给代理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="rsync命令"><a href="#rsync命令" class="headerlink" title="rsync命令"></a>rsync命令</h1><p>基于ssh和rsh服务实现高效率的远程系统之间复制文件<br>使用安全的shell连接做为传输方式</p>
<blockquote>
<p>rsync -av /etc server1:/tmp 复制目录和目录下文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; [root@CentOS6 data]<span class="comment">#ll ssl</span></span><br><span class="line">&gt; total 12</span><br><span class="line">&gt; -rw-r--r--. 1 root root 3715 Nov 14 12:27 app.crt</span><br><span class="line">&gt; -rw-r--r--. 1 root root  655 Nov 14 08:52 app.csr</span><br><span class="line">&gt; -rw-------. 1 root root  887 Nov 14 08:48 app.key</span><br><span class="line">&gt; [root@CentOS6 data]<span class="comment">#rsync -av /data/ssl 192.168.183.148:/data</span></span><br><span class="line">&gt; root@192.168.183.148<span class="string">'s password: </span></span><br><span class="line"><span class="string">&gt; sending incremental file list</span></span><br><span class="line"><span class="string">&gt; ssl/</span></span><br><span class="line"><span class="string">&gt; ssl/app.crt</span></span><br><span class="line"><span class="string">&gt; ssl/app.csr</span></span><br><span class="line"><span class="string">&gt; ssl/app.key</span></span><br><span class="line"><span class="string">&gt; </span></span><br><span class="line"><span class="string">&gt; sent 5472 bytes  received 73 bytes  528.10 bytes/sec</span></span><br><span class="line"><span class="string">&gt; total size is 5257  speedup is 0.95</span></span><br><span class="line"><span class="string">&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>rsync -av /etc/ server1:/tmp 只复制目录下文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; [root@CentOS6 data]<span class="comment">#rsync -av /data/ssl/ 192.168.183.148:/data</span></span><br><span class="line">&gt; root@192.168.183.148<span class="string">'s password: </span></span><br><span class="line"><span class="string">&gt; sending incremental file list</span></span><br><span class="line"><span class="string">&gt; ./</span></span><br><span class="line"><span class="string">&gt; app.crt</span></span><br><span class="line"><span class="string">&gt; app.csr</span></span><br><span class="line"><span class="string">&gt; app.key</span></span><br><span class="line"><span class="string">&gt; </span></span><br><span class="line"><span class="string">&gt; sent 5460 bytes  received 72 bytes  1229.33 bytes/sec</span></span><br><span class="line"><span class="string">&gt; total size is 5257  speedup is 0.95</span></span><br><span class="line"><span class="string">&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>比scp更快，只复制不同的文件<br>常用选项：</p>
<p>​    -n 模拟复制过程<br>​    -v 显示详细过程<br>​    -r 递归复制目录树<br>​    -p 保留权限<br>​    -t 保留时间戳<br>​    -g 保留组信息<br>​    -o 保留所有者信息<br>​    -l 将软链接文件本身进行复制（默认）<br>​    -L 将软链接文件指向的文件复制<br>​    -a 存档，相当于–rlptgoD，但不保留ACL（-A）和SELinux属性（-X）</p>
<h1 id="pssh工具"><a href="#pssh工具" class="headerlink" title="pssh工具"></a>pssh工具</h1><p>pssh是一个python编写可以在多台服务器上执行命令的工具，也可实现文件复制<br>选项如下：<br>–version：查看版本<br>-h：主机文件列表，内容格式” [user@]host[:port]”<br>-H：主机字符串，内容格式” [user@]host[:port]”<br>-A：手动输入密码模式<br>-i：每个服务器内部处理信息输出<br>-l：登录使用的用户名<br>-p：并发的线程数【可选】<br>-o：输出的文件目录【可选】<br>-e：错误输入文件【可选】<br>-t：TIMEOUT 超时时间设置，0无限制【可选】<br>-O：SSH的选项<br>-P：打印出服务器返回信息<br>-v：详细模式</p>
<p>pssh示例</p>
<ol>
<li><p>通过pssh批量关闭seLinux</p>
<blockquote>
<p>pssh -H <a href="mailto:root@192.168.183.158" target="_blank" rel="noopener">root@192.168.183.158</a> -i “sed-i “s/SELINUX=enforcing/SELINUX=disabled/“ /etc/selinux/config”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; [root@cetos7 ~]<span class="comment">#pssh -H root@192.168.183.158 -i "sed -i "s/SELINUX=enforcing/SELINUX=disabled/" /etc/selinux/config"</span></span><br><span class="line">&gt; [1] 20:25:13 [SUCCESS] root@192.168.183.158</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>批量发送指令</p>
<blockquote>
<p>pssh -H <a href="mailto:root@192.168.1.10" target="_blank" rel="noopener">root@192.168.1.10</a> -i setenforce 0<br>pssh -H <a href="mailto:wang@192.168.1.10" target="_blank" rel="noopener">wang@192.168.1.10</a> -i hostname</p>
</blockquote>
</li>
<li><p>当不支持ssh的key认证时，通过 -A选项，使用密码认证批量执行指令</p>
<blockquote>
<p>pssh -H <a href="mailto:wang@192.168.1.10" target="_blank" rel="noopener">wang@192.168.1.10</a> -A -i hostname</p>
</blockquote>
</li>
<li><p>将标准错误和标准正确重定向都保存至/app目录下</p>
<blockquote>
<p>pssh -H 192.168.1.10 -o /app -e /app -i “hostname”</p>
</blockquote>
</li>
</ol>
<h1 id="SSH端口转发"><a href="#SSH端口转发" class="headerlink" title="SSH端口转发"></a>SSH端口转发</h1><p>    SSH会自动加密和解密所有SSH客户端与服务端之间的网络数据。但是SSH还能够将其他TCP端口的网络数据通过SSH链接来转发，并且自动提供了相应的加密及解密服务。这一过程也被叫做“隧道”（tunneling),这是因为 SSH 为其他TCP链接提供了一个安全的通道来进行传输而得名。例如Telnet，SMTP，LDAP这些TCP应用均能够从中得益，避免了用户名，密码以及隐私信息的明文传输。而与此同时，如果工作环境中的防火墙限制了一些网络端口的使用，但是允许SSH的连接，也能够通过将TCP端口转发来使用SSH进行通讯</p>
<p>SSH 端口转发能够提供两大功能：</p>
<blockquote>
<p>加密 SSH Client 端至 SSH Server 端之间的通讯数据<br>突破防火墙的限制完成一些之前无法建立的 TCP 连接SSH端口转发</p>
</blockquote>
<ol>
<li><p>本地转发：</p>
<p> -L localport:remotehost:remotehostport sshserver</p>
<p> 选项：</p>
<p> -f 后台启用</p>
<p> -N 不打开远程shell，处于等待状态</p>
<p> -g 启用网关功能</p>
<p> 示例</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ssh –L 9527:telnetsrv:23 -Nfg sshsrv</span><br><span class="line">telnet 127.0.0.1 9527 </span><br><span class="line">​``` </span><br><span class="line">当访问本机的9527的端口时，被加密后转发到sshsrv的ssh服务，再解密被转发到telnetsrv:23</span><br><span class="line">&gt;data &lt;--&gt; localhost:9527 &lt;--&gt; localhost:XXXXX &lt;--&gt; sshsrv:22 &lt;--&gt; sshsrv:YYYYY &lt;--&gt; telnetsrv:23</span><br><span class="line"></span><br><span class="line">2. 远程转发:</span><br><span class="line">-R sshserverport:remotehost:remotehostport sshserver  </span><br><span class="line">示例：</span><br><span class="line">​```bash</span><br><span class="line">ssh –R 9527:telnetsrv:23 –Nf sshsrv</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>让sshsrv侦听9527端口的访问，如有访问，就加密后通过ssh服务转发请求到本机ssh客户端，再由本机解密后转发到telnetsrv:23</p>
<blockquote>
<p>Data <--> sshsrv:9527 <--> sshsrv:22 <--> localhost:XXXXX <-->localhost:YYYYY <--> telnetsrv:23</--></--></--></--></--></p>
</blockquote>
<ol>
<li><p>动态端口转发：<br> 当用firefox访问internet时，本机的1080端口做为代理服务器，firefox的访问请求被转发到sshserver上，由sshserver替之访问internet</p>
<blockquote>
<p>ssh -D 1080 root@sshserver -fNg<br>在本机firefox设置代理socket proxy:127.0.0.1:1080<br>curl –socks5 127.0.0.1:1080 <a href="http://www.qq.com" target="_blank" rel="noopener">http://www.qq.com</a></p>
</blockquote>
</li>
<li><p>X 协议转发<br> 所有图形化应用程序都是X客户程序</p>
<blockquote>
<p>能够通过tcp/ip连接远程X服务器<br>数据没有加密机，但是它通过ssh连接隧道安全进行</p>
</blockquote>
</li>
</ol>
<p>ssh -X user@remotehost gedit<br>remotehost主机上的gedit工具，将会显示在本机的X服务器上<br>传输的数据将通过ssh连接加密</p>
<h1 id="ssh服务器"><a href="#ssh服务器" class="headerlink" title="ssh服务器"></a>ssh服务器</h1><p>服务器端：sshd</p>
<h2 id="配置文件-etc-ssh-sshd-config"><a href="#配置文件-etc-ssh-sshd-config" class="headerlink" title="配置文件: /etc/ssh/sshd_config"></a>配置文件: /etc/ssh/sshd_config</h2><p>常用参数：<br>Port<br>ListenAddress ip<br>LoginGraceTime 2m<br>PermitRootLogin yes<br>StrictModes yes 检查.ssh/文件的所有者，权限等<br>MaxAuthTries 6<br>MaxSessions 10 同一个连接最大会话<br>PubkeyAuthentication yes<br>PermitEmptyPasswords no<br>PasswordAuthentication yes<br>GatewayPorts no<br>ClientAliveInterval 单位:秒<br>ClientAliveCountMax 默认3<br>UseDNS yes<br>GSSAPIAuthentication yes 提高速度可改为no<br>MaxStartups 未认证连接最大值，默认值10<br>Banner /path/file 登录提示信息<br>限制可登录用户的办法：</p>
<blockquote>
<p>AllowUsers user1 user2 user3<br>DenyUsers<br>AllowGroups<br>DenyGroup</p>
</blockquote>
<h2 id="sssh服务的最佳实践"><a href="#sssh服务的最佳实践" class="headerlink" title="sssh服务的最佳实践"></a>sssh服务的最佳实践</h2><p>建议使用非默认端口<br>禁止使用protocol version 1<br>限制可登录用户<br>设定空闲会话超时时长<br>利用防火墙设置ssh访问策略<br>仅监听特定的IP地址<br>基于口令认证时，使用强密码策略</p>
<blockquote>
<p>tr -dc A-Za-z0-9_ &lt; /dev/urandom | head -c 12| xargs<br>使用基于密钥的认证<br>禁止使用空密码<br>禁止root用户直接登录<br>限制ssh的访问频度和并发在线数<br>经常分析日志</p>
</blockquote>
<h1 id="编译安装dropbear"><a href="#编译安装dropbear" class="headerlink" title="编译安装dropbear"></a>编译安装dropbear</h1><p>ssh协议的另一个实现：dropbear</p>
<h2 id="源码编译安装："><a href="#源码编译安装：" class="headerlink" title="源码编译安装："></a>源码编译安装：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 安装开发包组:yum groupinstall <span class="string">"Development tools"</span>    </span><br><span class="line">2. 下载dropbear-2017.75.tar.bz2 </span><br><span class="line"></span><br><span class="line">wget https://matt.ucc.asn.au/dropbear/dropbear-2017.75.tar.bz2</span><br><span class="line"></span><br><span class="line">3. tar xf dropbear-2017.75.tar.bz2  </span><br><span class="line">4.  cat INSTALL </span><br><span class="line">    cat README  </span><br><span class="line">5. ./configure --prefix=/app/dropbear --sysconfdir=/etc/dropbear</span><br><span class="line">6. make PROGRAMS=<span class="string">"dropbear dbclient dropbearkey dropbearconvert scp"</span>  </span><br><span class="line">7. make PROGRAMS=<span class="string">"dropbear dbclient dropbearkey dropbearconvert scp"</span> install</span><br></pre></td></tr></table></figure>
<h2 id="启动ssh服务："><a href="#启动ssh服务：" class="headerlink" title="启动ssh服务："></a>启动ssh服务：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. ls /app/dropbear/sbin/ /app/dropbear/bin/  </span><br><span class="line">2. /app/dropbear/sbin/dropbear -h  </span><br><span class="line">3. mkdir /etc/dropbear  </span><br><span class="line">4. <span class="built_in">cd</span> /app/dropbear/bin</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'PATH=$PATH:/app/dropbear/bin:/app/dropbear/sbin'</span> &gt; /etc/profile.d/dropbear.sh</span><br><span class="line">dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_host_key   </span><br><span class="line">5.  <span class="built_in">cd</span> /app/dropbear/sbin</span><br><span class="line">dropbear -p :2222 -F –E  <span class="comment">#前台运行  </span></span><br><span class="line">dropbear -p :2222        <span class="comment">#后台运行</span></span><br><span class="line">6. 客户端访问：</span><br><span class="line">ssh -p 2222 root@127.0.0.1  </span><br><span class="line">或者</span><br><span class="line"><span class="built_in">cd</span> /app/dropbear/bin</span><br><span class="line">dbclient 127.0.0.1</span><br></pre></td></tr></table></figure>
<h1 id="AIDE"><a href="#AIDE" class="headerlink" title="AIDE"></a>AIDE</h1><p>    当一个入侵者进入了你的系统并且种植了木马，通常会想办法来隐蔽这个木马（除了木马自身的一些隐蔽特性外,他会尽量给你检查系统的过程设置障碍),通常入侵者会修改一些文件,比如管理员通常用<code>ps -aux</code>来查看系统进程，那么入侵者很可能用自己经过修改的ps程序来替换掉你系统上的ps程序，以使用ps命令查不到正在运行的木马程序。如果入侵者发现管理员正在运行crontab作业,也有可能替换掉crontab程序等等。所以由此可以看出对于系统文件或是关键文件的检查是很必要的.目前就系统完整性检查的工具用的比较多的有两款:Tripwire和AIDE，前者是一款商业软件,后者是一款免费的但功能也很强大的工具.</p>
<ul>
<li>AIDE:高级入侵检测环境)是一个入侵检测工具，主要用途是检查文件的完整性，审计计算机上的那些文件被更改过了.</li>
<li>AIDE能够构造一个指定文件的数据库，它使用aide.conf作为其配置文件。 AIDE数据库能够保存文件的各种属性，包括：权限(permission)、索引节点序号(inode number)、所属用户(user)、所属用户组(group)、文件大小、最后修改时间(mtime)、创建时间(ctime)、最后访问时间(atime)、增加的大小以及连接数。 AIDE还能够使用下列算法：sha1、 md5、 rmd160、 tiger，以密文形式建立每个文件的校验码或散列号</li>
<li>这个数据库不应该保存那些经常变动的文件信息，例如：日志文件、邮件、 /proc文件系统、用户起始目录以及临时目录.</li>
</ul>
<ol>
<li><p>安装<br> yum install aide</p>
</li>
<li><p>修改配置文件</p>
<p> vim /etc/aide.conf (指定对哪些文件进行检测)</p>
<blockquote>
<p>/test/chameleon R<br>/bin/ps R+a<br>/usr/bin/crontab R+a<br>/etc PERMS<br>!/etc/mtab #“!” 表示忽略这个文件的检查<br>R=p+i+n+u+g+s+m+c+md5<br>权限+索引节点+链接数+用户+组+大小+最后一次修改时间+创建时间+md5校验值<br>NORMAL = R+rmd60+sha256</p>
</blockquote>
</li>
<li><p>初始化默认的AIDE的库：</p>
<blockquote>
<p>aide –init</p>
</blockquote>
</li>
<li><p>生成检查数据库（建议初始数据库存放到安全的地方）</p>
<blockquote>
<p>cd /var/lib/aide<br>mv aide.db.new.gz aide.db.gz</p>
</blockquote>
</li>
<li><p>检测：</p>
<blockquote>
<p>aide –check/-C</p>
</blockquote>
</li>
<li><p>更新数据库</p>
<blockquote>
<p>aide –update</p>
</blockquote>
</li>
</ol>
<h1 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h1><ul>
<li><p>sudo能够授权指定用户在指定主机上运行某些命令。 如果未授权用户尝试使用 sudo，会提示联系管理员</p>
</li>
<li><p>sudo可以提供日志，记录每个用户使用sudo操作</p>
</li>
<li><p>sudo为系统管理员提供配置文件，允许系统管理员集中地管理用户的使用权限和使用的主机</p>
</li>
<li><p>sudo使用时间戳文件来完成类似“检票”的系统，默认存活期为5分钟的“入场券”</p>
</li>
<li><p>通过visudo命令编辑配置文件，具有语法检查功能</p>
<blockquote>
<p>visudo –c 检查语法<br>visudo -f /etc/sudoers.d/test</p>
</blockquote>
</li>
<li><p>配置文件：/etc/sudoers, /etc/sudoers.d/</p>
</li>
<li><p>时间戳文件：/var/db/sudo</p>
</li>
<li><p>日志文件：/var/log/secure</p>
</li>
<li><p>配置文件支持使用通配符glob</p>
<blockquote>
<p>？:任意单一字符</p>
<ul>
<li>:匹配任意长度字符</li>
</ul>
<p>[wxc]:匹配其中一个字符<br>[!wxc]:除了这三个字符的其它字符<br>\x : 转义<br>[[alpha]]:字母 示例： /bin/ls [[alpha]]*</p>
</blockquote>
</li>
</ul>
<p>配置文件规则有两类<br>1、别名定义:不是必须的<br>2、授权规则:必须的<br>授权规则格式 ：<br>用户 登入主机=(代表用户) 命令<br>示例：<br>root ALL=(ALL) ALL<br>格式说明：<br>user: 运行命令者的身份<br>host: 通过哪些主机<br>(runas)：以哪个用户的身份<br>command: 运行哪些命令</p>
<ul>
<li><p>别名</p>
<blockquote>
<p>Users和runas:</p>
<blockquote>
<p>username<br>#uid<br>%group_name<br>%#gid<br>user_alias|runas_alias</p>
</blockquote>
</blockquote>
</li>
<li><p>host:</p>
<blockquote>
<p>ip或hostname<br>network(/netmask)<br>host_alias</p>
</blockquote>
</li>
</ul>
<p>*command:</p>
<blockquote>
<p>command name<br>directory<br>sudoedit<br>Cmnd_Alias</p>
</blockquote>
<h2 id="sudo别名和示例"><a href="#sudo别名和示例" class="headerlink" title="sudo别名和示例"></a>sudo别名和示例</h2><ul>
<li>别名有四种类型：User_Alias, Runas_Alias, Host_Alias ，Cmnd_Alias</li>
<li>别名格式：<a href="[A-Z][0-9]_">A-Z</a>*</li>
<li>别名定义：<br>  Alias_Type NAME1 = item1, item2, item3 : NAME2 = item4, item5</li>
</ul>
<p>示例1：</p>
<blockquote>
<p>Student ALL=(ALL) ALL<br>%wheel ALL=(ALL) ALL</p>
</blockquote>
<p>示例2：</p>
<blockquote>
<p>student ALL=(root) /sbin/pidof,/sbin/ifconfig<br>%wheel ALL=(ALL) NOPASSWD: ALL</p>
</blockquote>
<p>示例3</p>
<blockquote>
<p>User_Alias NETADMIN= netuser1,netuser2<br>Cmnd_Alias NETCMD = /usr/sbin/ip<br>NETADMIN ALL=（root） NETCMD</p>
</blockquote>
<p>示例4</p>
<blockquote>
<p>User_Alias SYSADER=wang,mage,%admins<br>User_Alias DISKADER=tom<br>Host_Alias SERS=<a href="http://www.magedu.com,172.16.0.0/24" target="_blank" rel="noopener">www.magedu.com,172.16.0.0/24</a><br>Runas_Alias OP=root<br>Cmnd_Alias SYDCMD=/bin/chown,/bin/chmod<br>Cmnd_Alias DSKCMD=/sbin/parted,/sbin/fdisk<br>SYSADER SERS= SYDCMD,DSKCMD<br>DISKADER ALL=(OP) DSKCMD</p>
</blockquote>
<p>示例5</p>
<blockquote>
<p>User_Alias ADMINUSER = adminuser1,adminuser2<br>Cmnd_Alias ADMINCMD = /usr/sbin/useradd，/usr/sbin/usermod,<br>/usr/bin/passwd [a-zA-Z]*, !/usr/bin/passwd root<br>ADMINUSER ALL=(root) NOPASSWD:ADMINCMD，<br>PASSWD:/usr/sbin/userdel</p>
</blockquote>
<p>示例6</p>
<blockquote>
<p>Defaults:wang runas_default=tom<br>wang ALL=(tom,jerry) ALL</p>
</blockquote>
<p>示例7</p>
<blockquote>
<p>wang 192.168.1.6,192.168.1.8=(root) /usr/sbin/,!/usr/sbin/useradd</p>
</blockquote>
<p>示例8</p>
<blockquote>
<p>wang ALL=(ALL) /bin/cat /var/log/messages*</p>
</blockquote>
<h2 id="sudo命令"><a href="#sudo命令" class="headerlink" title="sudo命令"></a>sudo命令</h2><p>ls -l /usr/bin/sudo<br>sudo –i –u wang 切换身份<br>sudo [-u user] COMMAND</p>
<blockquote>
<p>-V 显示版本信息等配置信息<br>-u user 默认为root<br>-l,ll 列出用户在主机上可用的和被禁止的命令<br>-v 再延长密码有效期限5分钟,更新时间戳<br>-k 清除时间戳（1970-01-01），下次需要重新输密码<br>-K 与-k类似，还要删除时间戳文件<br>-b 在后台执行指令<br>-p 改变询问密码的提示符号<br>示例：-p “password on %h for user %p:”</p>
</blockquote>
<h1 id="TCP-Wrappers"><a href="#TCP-Wrappers" class="headerlink" title="TCP_Wrappers"></a>TCP_Wrappers</h1><ol>
<li><p>工作在第四层（传输层）的TCP协议</p>
</li>
<li><p>对有状态连接的特定服务进行安全检测并实现访问控制</p>
</li>
<li><p>以库文件形式实现</p>
</li>
<li><p>某进程是否接受libwrap的控制取决于发起此进程的程序在编译时是否针对libwrap进行编译的</p>
</li>
<li><p>判断服务程序是否能够由tcp_wrapper进行访问控制的方法：</p>
<blockquote>
<p>ldd /PATH/TO/PROGRAM|grep libwrap.so<br>strings PATH/TO/PROGRAM|grep libwrap.so</p>
</blockquote>
</li>
</ol>
<h2 id="TCP-Wrappers的使用"><a href="#TCP-Wrappers的使用" class="headerlink" title="TCP_Wrappers的使用"></a>TCP_Wrappers的使用</h2><ol>
<li>配置文件：/etc/hosts.allow, /etc/hosts.deny</li>
<li>检查顺序：hosts.allow，hosts.deny<br> 注意：一旦前面规则匹配，直接生效，将不再继续（默认允许）</li>
<li>基本语法:<br> daemon_list@host: client_list [ :options :option… ]</li>
<li>Daemon_list@host格式<br> 单个应用程序的二进制文件名，而非服务名，例如vsftpd<br> 以逗号或空格分隔的应用程序文件名列表，如:sshd,vsftpd<br> ALL表示所有接受tcp_wrapper控制的服务程序<br> 主机有多个IP，可用@hostIP来实现控制<br> 如：<a href="mailto:in.telnetd@192.168.0.254" target="_blank" rel="noopener">in.telnetd@192.168.0.254</a></li>
</ol>
<h2 id="客户端Client-list格式"><a href="#客户端Client-list格式" class="headerlink" title="客户端Client_list格式"></a>客户端Client_list格式</h2><blockquote>
<p>以逗号或空格分隔的客户端列表<br>基于IP地址：192.168.10.1 192.168.1.<br>基于主机名：<a href="http://www.magedu.com" target="_blank" rel="noopener">www.magedu.com</a> .magedu.com 较少用<br>基于网络/掩码：192.168.0.0/255.255.255.0<br>基于net/prefixlen: 192.168.1.0/24（CentOS7）<br>基于网络组（NIS 域）：@mynetwork<br>内置ACL：ALL，LOCAL，KNOWN，UNKNOWN，PARANOID<br>EXCEPT用法：<br>示例：<br>vsftpd: 172.16. EXCEPT 172.16.100.0/24 EXCEPT 172.16.100.1<br>示例：只允许192.168.1.0/24的主机访问sshd</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; /etc/hosts.allow    </span><br><span class="line">&gt; sshd: 192.168.1.    </span><br><span class="line">&gt; /etc/hosts.deny    </span><br><span class="line">&gt; sshd :ALL</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>示例：只允许192.168.1.0/24的主机访问telnet和vsftpd服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/hosts.allow</span><br><span class="line">vsftpd,in.telnetd: 192.168.1.</span><br><span class="line">/etc/host.deny  </span><br><span class="line">vsftpd,in.telnetd: ALL</span><br></pre></td></tr></table></figure>
<h2 id="options-选项："><a href="#options-选项：" class="headerlink" title="[:options]选项："></a>[:options]选项：</h2><ol>
<li><p>deny 主要用在/etc/hosts.allow定义“拒绝”规则<br> 如：vsftpd: 172.16. :deny</p>
</li>
<li><p>allow 主要用在/etc/hosts.deny定义“允许” 规则<br> 如：vsftpd:172.16. :allow</p>
</li>
<li><p>spawn 启动一个外部程序完成执行的操作<br> 示例</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshd: ALL :spawn <span class="built_in">echo</span> <span class="string">"<span class="variable">$(date +%%F)</span> login attempt from %c to %s,%d"</span> &gt;&gt; /var/<span class="built_in">log</span>/sshd.log</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>说明：<br>在/etc/hosts.allow中添加，允许登录，并记录日志<br>在/etc/hosts.deny中添加，拒绝登录，并记录日志</p>
<blockquote>
<p>%c 客户端信息<br>%s 服务器端信息<br>%d 服务名<br>%p 守护进程的PID<br>%% 表示%</p>
<ol>
<li><p>twist 实际动作是拒绝访问,使用指定操作替换当前服务,标准输出和ERROR</p>
<p> 发送到客户端,默认至/dev/null</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; 	vsftpd: 172.16. :twist /bin/<span class="built_in">echo</span> <span class="string">"connection prohibited"</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<h1 id="PAM模块"><a href="#PAM模块" class="headerlink" title="PAM模块"></a>PAM模块</h1><ol>
<li><p>认证库：文本文件，MySQL，NIS，LDAP等</p>
</li>
<li><p>Sun公司于1995 年开发的一种与认证相关的通用框架机制</p>
</li>
<li><p>PAM 是关注如何为服务验证用户的 API，通过提供一些动态链接库和一套统一的API，将系统提供的服务和该服务的认证方式分开.使得系统管理员可以灵活地根据需要给不同的服务配置不同的认证方式而无需更改服务程序</p>
</li>
<li><p>一种认证框架，自身不做认证</p>
</li>
<li><p>它提供了对所有服务进行认证的中央机制，适用于本地登录，远程登录，如：telnet,rlogin,fsh,ftp,点对点协议PPP，su等应用程序中，系统管理员通过PAM配置文件来制定不同应用程序的不同认证策略；应用程序开发者通过在服务程序中使用PAM API(pam_xxxx( ))来实现对认证方法的调用；而PAM服务模块的开发者则利用PAM SPI来编写模块（主要调用函数pam_sm_xxxx( )供PAM接口库调用，将不同的认证机制加入到系统中；PAM接口库（libpam）则读取配置文件，将应用程序和相应的PAM服务模块联系起来</p>
</li>
</ol>
<h2 id="PAM架构"><a href="#PAM架构" class="headerlink" title="PAM架构"></a>PAM架构</h2><p>  <img src="https://github.com/xiejia1215225/Pictures/blob/master/PAM%E6%9E%B6%E6%9E%84.png?raw=true" alt="PAM架构.png"></p>
<h2 id="PAM相关文件"><a href="#PAM相关文件" class="headerlink" title="PAM相关文件"></a>PAM相关文件</h2><ol>
<li><p>模块文件目录：/lib64/security/*.so</p>
</li>
<li><p>环境相关的设置：/etc/security/</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@cetos7 bin]<span class="comment">#cd /lib64/security/</span></span><br><span class="line">[root@cetos7 security]<span class="comment">#ls</span></span><br><span class="line">pam_access.so     pam_gdm.so               pam_permit.so          pam_time.so</span><br><span class="line">pam_cap.so        pam_gnome_keyring.so     pam_postgresok.so      pam_timestamp.so</span><br><span class="line">pam_chroot.so     pam_group.so             pam_pwhistory.so       pam_tty_audit.so</span><br><span class="line">pam_console.so    pam_issue.so             pam_pwquality.so       pam_umask.so</span><br><span class="line">pam_cracklib.so   pam_keyinit.so           pam_rhosts.so          pam_unix_acct.so</span><br><span class="line">pam_debug.so      pam_lastlog.so           pam_rootok.so          pam_unix_auth.so</span><br><span class="line">pam_deny.so       pam_limits.so            pam_securetty.so       pam_unix_passwd.so</span><br><span class="line">pam_echo.so       pam_listfile.so          pam_selinux_permit.so  pam_unix_session.so</span><br><span class="line">pam_env.so        pam_localuser.so         pam_selinux.so         pam_unix.so</span><br><span class="line">pam_exec.so       pam_loginuid.so          pam_sepermit.so        pam_userdb.so</span><br><span class="line">pam_faildelay.so  pam_mail.so              pam_shells.so          pam_warn.so</span><br><span class="line">pam_faillock.so   pam_mkhomedir.so         pam_sss.so             pam_wheel.so</span><br><span class="line">pam_filter        pam_motd.so              pam_stress.so          pam_xauth.so</span><br><span class="line">pam_filter.so     pam_namespace.so         pam_succeed_if.so</span><br><span class="line">pam_fprintd.so    pam_nologin.so           pam_systemd.so</span><br><span class="line">pam_ftp.so        pam_oddjob_mkhomedir.so  pam_tally2.so</span><br></pre></td></tr></table></figure>
</li>
<li><p>主配置文件:/etc/pam.conf，默认不存在</p>
</li>
<li><p>为每种应用模块提供一个专用的配置文件：/etc/pam.d/APP_NAME</p>
<p> 注意：如/etc/pam.d存在，/etc/pam.conf将失效pam认证原理</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@cetos7 security]<span class="comment">#cd /etc/pam.d/</span></span><br><span class="line">[root@cetos7 pam.d]<span class="comment">#ls</span></span><br><span class="line">atd                  gdm-launch-environment  pluto         smartcard-auth     system-auth-ac</span><br><span class="line">chfn                 gdm-password            polkit-1      smartcard-auth-ac  systemd-user</span><br><span class="line">chsh                 gdm-pin                 postlogin     smtp               vlock</span><br><span class="line">config-util          gdm-smartcard           postlogin-ac  smtp.postfix       vmtoolsd</span><br><span class="line">crond                liveinst                ppp           sshd               vsftpd</span><br><span class="line">cups                 login                   remote        su                 xserver</span><br><span class="line">fingerprint-auth     other                   runuser       sudo</span><br><span class="line">fingerprint-auth-ac  passwd                  runuser<span class="_">-l</span>     sudo-i</span><br><span class="line">gdm-autologin        password-auth           screen        su<span class="_">-l</span></span><br><span class="line">gdm-fingerprint      password-auth-ac        setup         system-auth</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="PAM认证原理"><a href="#PAM认证原理" class="headerlink" title="PAM认证原理"></a>PAM认证原理</h2><ol>
<li>PAM认证一般遵循这样的顺序：Service(服务)→PAM(配置文件)→pam_*.so</li>
<li>PAM认证首先要确定那一项服务，然后加载相应的PAM的配置文件(位于/etc/pam.d下)，最后调用认证文件(位于/lib/security下)进行安全认证</li>
</ol>
<h2 id="PAM配置文件详解"><a href="#PAM配置文件详解" class="headerlink" title="PAM配置文件详解"></a>PAM配置文件详解</h2><p>专用配置文件/etc/pam.d/* 格式<br>type control module-path arguments<br>说明：</p>
<h3 id="模块类型（module-type）"><a href="#模块类型（module-type）" class="headerlink" title="模块类型（module-type）"></a>模块类型（module-type）</h3><blockquote>
<p>Auth 账号的认证和授权<br>Account 与账号管理相关的非认证类的功能，如：用来限制/允许用户对某个服务的访问时间，当前有效的系统资源(最多可以有多少个用户)，限制用户的位置(例如：root用户只能从控制台登录)<br>Password 用户修改密码时密码复杂度检查机制等功能<br>Session 用户获取到服务之前或使用服务完成之后需要进行一些附加的操作，如：记录打开/关闭数据的信息，监视目录等<br>-type 表示因为缺失而不能加载的模块将不记录到系统日志,对于那些不总是安装在系统上的模块有用</p>
</blockquote>
<h3 id="Control"><a href="#Control" class="headerlink" title="Control:"></a>Control:</h3><ol>
<li><p>PAM库如何处理与该服务相关的PAM模块成功或失败情况</p>
</li>
<li><p>两种方式实现：简单和复杂</p>
<blockquote>
<blockquote>
<p>简单方式实现：一个关健词实现</p>
<blockquote>
<p>required ：一票否决，表示本模块必须返回成功才能通过认证，但是如果该模块返回失败，失败结果也不会立即通知用户，而是要等到同一type中的所有模块全部执行完毕再将失败结果返回给应用程序，即为必要条件<br>requisite ：一票否决，该模块必须返回成功才能通过认证，但是一旦该模块返回失败，将不再执行同一type内的任何模块，而是直接将控制权返回给应用程序。是一个必要条件<br>sufficient ：一票通过，表明本模块返回成功则通过身份认证的要求，不必再执行同一type内的其它模块，但如果本模块返回失败可忽略，即为充分条件<br>optional ：表明本模块是可选的，它的成功与否不会对身份认证起关键作用，其返回值一般被忽略<br>include： 调用其他的配置文件中定义的配置信息</p>
</blockquote>
</blockquote>
</blockquote>
</li>
</ol>
<blockquote>
<blockquote>
<p>复杂详细实现：使用一个或多个“status=action”<br>[status1=action1 status2=action …]<br>Status:检查结果的返回状态<br>Action:采取行为 ok，done，die，bad，ignore，reset</p>
<blockquote>
<p>ok 模块通过，继续检查<br>done 模块通过，返回最后结果给应用<br>bad 结果失败，继续检查<br>die 结果失败，返回失败结果给应用<br>ignore 结果忽略，不影响最后结果<br>reset 忽略已经得到的结果PAM认证机制</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="module-path-模块路径"><a href="#module-path-模块路径" class="headerlink" title="module-path: 模块路径"></a>module-path: 模块路径</h3><ol>
<li><p>相对路径：<br> /lib64/security目录下的模块可使用相对路径<br> 如：pam_shells.so、 pam_limits.so</p>
</li>
<li><p>绝对路径：</p>
<p> 模块通过读取配置文件完成用户对系统资源的使用控制</p>
<p> /etc/security/*.conf</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：修改PAM配置文件将马上生效</span><br></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">编辑pam规则时，保持至少打开一个root会话，以防止root身份验证错误</span><br></pre></td></tr></table></figure>
<h3 id="Arguments-用来传递给该模块的参数"><a href="#Arguments-用来传递给该模块的参数" class="headerlink" title="Arguments 用来传递给该模块的参数"></a>Arguments 用来传递给该模块的参数</h3></li>
</ol>
<h2 id="PAM模块示例"><a href="#PAM模块示例" class="headerlink" title="PAM模块示例"></a>PAM模块示例</h2><h3 id="模块：pam-shells"><a href="#模块：pam-shells" class="headerlink" title="模块：pam_shells"></a>模块：pam_shells</h3><p>功能：检查有效shell<br>man pam_shells<br>例：不允许使用/bin/csh的用户进行切换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@cetos7 ~]<span class="comment">#vim /etc/pam.d/su  </span></span><br><span class="line">auth required pam_shells.so  </span><br><span class="line">[root@cetos7 pam.d]<span class="comment">#cat /etc/shells </span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/sbin/nologin</span><br><span class="line">/usr/bin/sh</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/usr/sbin/nologin</span><br><span class="line">/bin/tcsh</span><br><span class="line"><span class="comment">#/bin/csh                                 用#把/bin/csh注释掉</span></span><br><span class="line">[root@cetos7 pam.d]<span class="comment">#getent passwd mage</span></span><br><span class="line">mage:x:1242:1244::/home/mage:/bin/bash</span><br><span class="line">[root@cetos7 pam.d]<span class="comment">#usermod -s /bin/csh mage</span></span><br><span class="line">[root@cetos7 pam.d]<span class="comment">#getent passwd mage      </span></span><br><span class="line">mage:x:1242:1244::/home/mage:/bin/csh       把账号xie的shell类型改成 /bin/csh</span><br><span class="line">[root@cetos7 pam.d]<span class="comment">#su - mage</span></span><br><span class="line">Password: </span><br><span class="line">su: Authentication failure                   mage账号将不可切换，其它不受影响 </span><br><span class="line">tail /var/<span class="built_in">log</span>/secure</span><br></pre></td></tr></table></figure>
<h3 id="模块：pam-securetty-so"><a href="#模块：pam-securetty-so" class="headerlink" title="模块：pam_securetty.so"></a>模块：pam_securetty.so</h3><p>功能：只允许root用户在/etc/securetty列出的安全终端上登陆<br>示例：允许root在telnet登陆</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]vim /etc/pam.d/remote  </span><br><span class="line"><span class="comment">#auth required pam_securetty.so #将这一行加上注释  </span></span><br><span class="line">或者/etc/securetty文件中加入  </span><br><span class="line">pts/0,pts/1…pts/n</span><br></pre></td></tr></table></figure>
<h3 id="模块：pam-nologin-so"><a href="#模块：pam-nologin-so" class="headerlink" title="模块：pam_nologin.so"></a>模块：pam_nologin.so</h3><p>功能：</p>
<ol>
<li>如果/etc/nologin文件存在,将导致非root用户不能登陆</li>
<li>如果用户shell是/sbin/nologin 时，当该用户登陆时，会显示/etc/nologin文件内容，并拒绝登陆</li>
</ol>
<h3 id="模块：pam-limits-so"><a href="#模块：pam-limits-so" class="headerlink" title="模块：pam_limits.so"></a>模块：pam_limits.so</h3><p>功能：在用户级别实现对其可使用的资源的限制，例如：可打开的文件数量，可运行的进程数量，可用内存空间<br>修改限制的实现方式：</p>
<ol>
<li><p>ulimit命令，立即生效，但无法保存</p>
<blockquote>
<p>-n 每个进程最多的打开的文件描述符个数<br>-u 最大用户进程数<br>-S 使用 soft（软）资源限制<br>-H 使用 hard（硬）资源限制</p>
</blockquote>
</li>
<li><p>配置文件：/etc/security/limits.conf, /etc/security/limits.d/*.conf<br> 配置文件：每行一个定义</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;domain&gt;  &lt;<span class="built_in">type</span>&gt;  &lt;item&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>\ 应用于哪些对象</p>
<blockquote>
<p>Username 单个用户<br>@group 组内所有用户<br>* 所有用户</p>
</blockquote>
</blockquote>
<blockquote>
<p>\ 限制的类型</p>
<blockquote>
<p>Soft 软限制,普通用户自己可以修改<br>Hard 硬限制,由root用户设定，且通过kernel强制生效<br>- 二者同时限定</p>
</blockquote>
</blockquote>
<blockquote>
<p>\ 限制的资源</p>
<blockquote>
<p>nofile 所能够同时打开的最大文件数量,默认为1024<br>nproc 所能够同时运行的进程的最大数量,默认为1024</p>
</blockquote>
</blockquote>
<blockquote>
<p>\ 指定具体值</p>
<blockquote>
<p>限制用户最多打开的文件数和运行进程数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; &gt; /etc/pam.d/system-auth  </span><br><span class="line">&gt; &gt; session required pam_limits.so  </span><br><span class="line">&gt; &gt; </span><br><span class="line">&gt; &gt; vim /etc/security/limits.conf  </span><br><span class="line">&gt; &gt; apache – nofile 10240   用户apache可打开10240个文件  </span><br><span class="line">&gt; &gt; student hard nproc 20   用户student不能运行超过20个进程</span><br><span class="line">&gt; &gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>

      
    </div>
    
    
    

  <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="谢 佳 WeChat Pay">
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="谢 佳 Alipay">
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/模块/" rel="tag"><i class="fa fa-tag"></i> 模块</a>
          
            <a href="/tags/加密/" rel="tag"><i class="fa fa-tag"></i> 加密</a>
          
            <a href="/tags/openssl/" rel="tag"><i class="fa fa-tag"></i> openssl</a>
          
            <a href="/tags/ssh/" rel="tag"><i class="fa fa-tag"></i> ssh</a>
          
            <a href="/tags/CA/" rel="tag"><i class="fa fa-tag"></i> CA</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/06/Centos6系统启动流程与grub/" rel="next" title="Centos6系统启动流程与grub">
                <i class="fa fa-chevron-left"></i> Centos6系统启动流程与grub
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/18/自动化安装系统/" rel="prev" title="自动化安装系统">
                自动化安装系统 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.gif" alt="谢 佳">
            
              <p class="site-author-name" itemprop="name">谢 佳</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">43</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#对称加密算法"><span class="nav-number">1.</span> <span class="nav-text">对称加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#对称加密"><span class="nav-number">1.1.</span> <span class="nav-text">对称加密</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#非对称加密算法"><span class="nav-number">2.</span> <span class="nav-text">非对称加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#公钥加密-密钥是成对出现"><span class="nav-number">2.1.</span> <span class="nav-text">公钥加密:密钥是成对出现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#非对称加密-基于一对公钥-密钥对"><span class="nav-number">2.2.</span> <span class="nav-text">非对称加密:基于一对公钥/密钥对</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#单向散列-数字指纹"><span class="nav-number">3.</span> <span class="nav-text">单向散列(数字指纹)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#密钥交换"><span class="nav-number">4.</span> <span class="nav-text">密钥交换</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用gpg实现对称加密"><span class="nav-number">5.</span> <span class="nav-text">使用gpg实现对称加密</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用gpg工具实现公钥加密"><span class="nav-number">6.</span> <span class="nav-text">使用gpg工具实现公钥加密</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#中间人攻击"><span class="nav-number">7.</span> <span class="nav-text">中间人攻击</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CA和证书"><span class="nav-number">8.</span> <span class="nav-text">CA和证书</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#证书获取"><span class="nav-number">8.1.</span> <span class="nav-text">证书获取</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安全协议"><span class="nav-number">9.</span> <span class="nav-text">安全协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SSL"><span class="nav-number">9.1.</span> <span class="nav-text">SSL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSL-TLS"><span class="nav-number">9.2.</span> <span class="nav-text">SSL/TLS</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#openssl命令"><span class="nav-number">10.</span> <span class="nav-text">openssl命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建CA和申请证书"><span class="nav-number">11.</span> <span class="nav-text">创建CA和申请证书</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SSH-22-tcp"><span class="nav-number">12.</span> <span class="nav-text">SSH(22/tcp)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh客户端"><span class="nav-number">12.1.</span> <span class="nav-text">ssh客户端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh服务登录验证方式："><span class="nav-number">12.2.</span> <span class="nav-text">ssh服务登录验证方式：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基于用户和口令登录验证"><span class="nav-number">12.2.1.</span> <span class="nav-text">基于用户和口令登录验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基于密钥的登录方式"><span class="nav-number">12.2.2.</span> <span class="nav-text">基于密钥的登录方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rsync命令"><span class="nav-number">13.</span> <span class="nav-text">rsync命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pssh工具"><span class="nav-number">14.</span> <span class="nav-text">pssh工具</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SSH端口转发"><span class="nav-number">15.</span> <span class="nav-text">SSH端口转发</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ssh服务器"><span class="nav-number">16.</span> <span class="nav-text">ssh服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件-etc-ssh-sshd-config"><span class="nav-number">16.1.</span> <span class="nav-text">配置文件: /etc/ssh/sshd_config</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sssh服务的最佳实践"><span class="nav-number">16.2.</span> <span class="nav-text">sssh服务的最佳实践</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#编译安装dropbear"><span class="nav-number">17.</span> <span class="nav-text">编译安装dropbear</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#源码编译安装："><span class="nav-number">17.1.</span> <span class="nav-text">源码编译安装：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动ssh服务："><span class="nav-number">17.2.</span> <span class="nav-text">启动ssh服务：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AIDE"><span class="nav-number">18.</span> <span class="nav-text">AIDE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sudo"><span class="nav-number">19.</span> <span class="nav-text">sudo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#sudo别名和示例"><span class="nav-number">19.1.</span> <span class="nav-text">sudo别名和示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sudo命令"><span class="nav-number">19.2.</span> <span class="nav-text">sudo命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TCP-Wrappers"><span class="nav-number">20.</span> <span class="nav-text">TCP_Wrappers</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#TCP-Wrappers的使用"><span class="nav-number">20.1.</span> <span class="nav-text">TCP_Wrappers的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#客户端Client-list格式"><span class="nav-number">20.2.</span> <span class="nav-text">客户端Client_list格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#options-选项："><span class="nav-number">20.3.</span> <span class="nav-text">[:options]选项：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PAM模块"><span class="nav-number">21.</span> <span class="nav-text">PAM模块</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#PAM架构"><span class="nav-number">21.1.</span> <span class="nav-text">PAM架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PAM相关文件"><span class="nav-number">21.2.</span> <span class="nav-text">PAM相关文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PAM认证原理"><span class="nav-number">21.3.</span> <span class="nav-text">PAM认证原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PAM配置文件详解"><span class="nav-number">21.4.</span> <span class="nav-text">PAM配置文件详解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模块类型（module-type）"><span class="nav-number">21.4.1.</span> <span class="nav-text">模块类型（module-type）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Control"><span class="nav-number">21.4.2.</span> <span class="nav-text">Control:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-path-模块路径"><span class="nav-number">21.4.3.</span> <span class="nav-text">module-path: 模块路径</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Arguments-用来传递给该模块的参数"><span class="nav-number">21.4.4.</span> <span class="nav-text">Arguments 用来传递给该模块的参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PAM模块示例"><span class="nav-number">21.5.</span> <span class="nav-text">PAM模块示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#模块：pam-shells"><span class="nav-number">21.5.1.</span> <span class="nav-text">模块：pam_shells</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块：pam-securetty-so"><span class="nav-number">21.5.2.</span> <span class="nav-text">模块：pam_securetty.so</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块：pam-nologin-so"><span class="nav-number">21.5.3.</span> <span class="nav-text">模块：pam_nologin.so</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块：pam-limits-so"><span class="nav-number">21.5.4.</span> <span class="nav-text">模块：pam_limits.so</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">谢 佳</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">96.4k</span>
  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <script type="text/javascript" src="//libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
  <!-- 雪花特效 -->
  <script type="text/javascript">
	var windowWidth = $(window).width();
	if (windowWidth > 480) {
    document.write('<script type="text/javascript" src="/js/src/snow.js"><\/script>');
	}
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>