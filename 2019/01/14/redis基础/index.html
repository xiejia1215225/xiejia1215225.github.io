<!DOCTYPE html>



  



<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="redis,">





  <link rel="alternate" href="/atom.xml" title="Linux知识库" type="application/atom+xml">






<meta name="description" content="一：缓存概念&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;缓存是为了调节速度不一致的两个或多个不同的物质的速度，在中间对速度较快的一方起到一个加速访问速度较慢的一方的作用，比如CPU的一级、二级缓存是保存了CPU最近经常访问的数据，内存是保存CPU经常访问硬盘的数据，而且硬盘也有大小不一的缓存，甚至是物理服务器的raid 卡有也缓存，都是为了起到加速CPU 访问硬盘数据的目的，因为CPU的速度太">
<meta name="keywords" content="redis">
<meta property="og:type" content="article">
<meta property="og:title" content="redis基础">
<meta property="og:url" content="http://yoursite.com/2019/01/14/redis基础/index.html">
<meta property="og:site_name" content="Linux知识库">
<meta property="og:description" content="一：缓存概念&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;缓存是为了调节速度不一致的两个或多个不同的物质的速度，在中间对速度较快的一方起到一个加速访问速度较慢的一方的作用，比如CPU的一级、二级缓存是保存了CPU最近经常访问的数据，内存是保存CPU经常访问硬盘的数据，而且硬盘也有大小不一的缓存，甚至是物理服务器的raid 卡有也缓存，都是为了起到加速CPU 访问硬盘数据的目的，因为CPU的速度太">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-01-20T07:05:49.420Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis基础">
<meta name="twitter:description" content="一：缓存概念&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;缓存是为了调节速度不一致的两个或多个不同的物质的速度，在中间对速度较快的一方起到一个加速访问速度较慢的一方的作用，比如CPU的一级、二级缓存是保存了CPU最近经常访问的数据，内存是保存CPU经常访问硬盘的数据，而且硬盘也有大小不一的缓存，甚至是物理服务器的raid 卡有也缓存，都是为了起到加速CPU 访问硬盘数据的目的，因为CPU的速度太">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/01/14/redis基础/">





  <title>redis基础 | Linux知识库</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
	
	<a href="https://github.com/xiejia1215225"><img style="position: absolute; top: 0; right: 0; border: 0
	;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Linux知识库</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/14/redis基础/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="谢 佳">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Linux知识库">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">redis基础</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-14T08:44:11+08:00">
                2019-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/nosql/" itemprop="url" rel="index">
                    <span itemprop="name">nosql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  8.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  34
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="一：缓存概念"><a href="#一：缓存概念" class="headerlink" title="一：缓存概念"></a>一：缓存概念</h1><p>&ensp;&ensp;&ensp;&ensp;缓存是为了调节速度不一致的两个或多个不同的物质的速度，在中间对速度较快的一方起到一个加速访问速度较慢的一方的作用，比如CPU的一级、二级缓存是保存了CPU最近经常访问的数据，内存是保存CPU经常访问硬盘的数据，而且硬盘也有大小不一的缓存，甚至是物理服务器的raid 卡有也缓存，都是为了起到加速CPU 访问硬盘数据的目的，因为CPU的速度太快了，CPU需要的数据硬盘往往不能在短时间内满足CPU的需求，因此PCU缓存、内存、Raid 卡以及硬盘缓存就在一定程度上满足了CPU的数据需求，即CPU 从缓存读取数据可以大幅提高CPU的工作效率。</p>
<h2 id="1-1：系统缓存"><a href="#1-1：系统缓存" class="headerlink" title="1.1：系统缓存"></a>1.1：系统缓存</h2><h3 id="1-1-1：buffer与cache"><a href="#1-1-1：buffer与cache" class="headerlink" title="1.1.1：buffer与cache"></a>1.1.1：buffer与cache</h3><p>buffer：缓冲也叫写缓冲，一般用于写操作，可以将数据先写入内存在写入磁盘，buffer 一般用于写缓冲，用于解决不同介质的速度不一致的缓冲，先将数据临时写入到里自己最近的地方，以提高写入速度，CPU会把数据线写到内存的磁盘缓冲区，然后就认为数据已经写入完成看，然后内核的线程在后面的时间在写入磁盘，所以服务器突然断电会丢失内存中的部分数据。</p>
<p>cache：缓存也叫读缓存，一般用于读操作，CPU读文件从内存读，如果内存没有就先从硬盘读到内存再读到CPU，将需要频繁读取的数据放在里自己最近的缓存区域，下次读取的时候即可快速读取。</p>
<h3 id="1-1-2：cache的保存位置"><a href="#1-1-2：cache的保存位置" class="headerlink" title="1.1.2：cache的保存位置"></a>1.1.2：cache的保存位置</h3><p>客户端：浏览器</p>
<p>内存：本地服务器、远程服务器</p>
<p>硬盘：本机硬盘、远程服务器硬盘</p>
<p>速度对比：</p>
<p>客户端浏览器-内存-远程内存-硬盘-远程硬盘。</p>
<h2 id="1-2：CDN缓存"><a href="#1-2：CDN缓存" class="headerlink" title="1.2：CDN缓存"></a>1.2：CDN缓存</h2><h3 id="1-2-1：CDN概念"><a href="#1-2-1：CDN概念" class="headerlink" title="1.2.1：CDN概念"></a>1.2.1：CDN概念</h3><p>&ensp;&ensp;&ensp;&ensp;内容分发网络（Content Delivery Network），通过将服务内容分发至全网加速节点，利用全球调度系统使用户能够就近获取，有效降低访问延迟，提升服务可用性。</p>
<p>第一降低机房的使用带宽，因为很多资源通过CDN就直接返回用户了；</p>
<p>第二解决不同运营商之间的互联，因为可以让联通的网络访问联通，让电信的网络访问电信，起到加速用户访问的目的；</p>
<p>第三：解决用户访问的地域问题，就近返回用户资源。</p>
<p>百度CDN：<a href="https://cloud.baidu.com/product/cdn.html" target="_blank" rel="noopener">https://cloud.baidu.com/product/cdn.html</a> </p>
<p>阿里CDN：<a href="https://www.aliyun.com/product/cdn" target="_blank" rel="noopener">https://www.aliyun.com/product/cdn</a> </p>
<p>腾讯CDN：<a href="https://www.qcloud.com/product/cdn" target="_blank" rel="noopener">https://www.qcloud.com/product/cdn</a> </p>
<h3 id="1-2-2：CDN主要优势"><a href="#1-2-2：CDN主要优势" class="headerlink" title="1.2.2：CDN主要优势"></a>1.2.2：CDN主要优势</h3><p>&ensp;&ensp;&ensp;&ensp;提前对静态内容进行预缓存，避免大量的请求回源，导致主站网络带宽被打满而导致数据无法更新，另外CDN可以将数据根据访问的热度不通而进行不通级别的缓存，例如访问量最高的资源访问CDN 边缘节点的内存，其次的放在SSD或者SATA，再其次的放在云存储，这样兼顾了速度与成本。缓存-缓存到最快的地方如内存，缓存的数据准确命中率高，访问速度就快</p>
<p>调度准确-将用户调度到最近的边缘节点</p>
<p>性能优化-CDN 专门用于缓存响应速度快</p>
<p>安全相关-抵御攻击</p>
<p>节省带宽：由于用户请求由边缘节点响应，因此大幅降低到源站带宽。</p>
<h2 id="1-3：应用层缓存"><a href="#1-3：应用层缓存" class="headerlink" title="1.3：应用层缓存"></a>1.3：应用层缓存</h2><p>&ensp;&ensp;&ensp;&ensp;Nginx、PHP等web服务可以设置应用缓存以加速响应用户请求，另外有些解释性语言比如PHP/Python不能直接运行，需要先编译成字节码，但字节码需要解释器解释为机器码之后才能执行，因此字节码也是一种缓存，有时候会出现程序代码上线后字节码没有更新的现象。  </p>
<h2 id="1-4：其他层面缓存"><a href="#1-4：其他层面缓存" class="headerlink" title="1.4：其他层面缓存"></a>1.4：其他层面缓存</h2><p>CPU缓存(L1的数据缓存和L1的指令缓存)、二级缓存、三级缓存</p>
<p>磁盘缓存</p>
<p>RAID卡</p>
<p>分布式缓存：redis、memcache</p>
<h1 id="二：redis部署"><a href="#二：redis部署" class="headerlink" title="二：redis部署"></a>二：redis部署</h1><h3 id="2-1-1：redis简介："><a href="#2-1-1：redis简介：" class="headerlink" title="2.1.1：redis简介："></a>2.1.1：redis简介：</h3><p>&ensp;&ensp;&ensp;&ensp;Redis(Remote Dictionary Server)在2009年发布，开发者Salvatore Sanfilippo是意大利开发者，他本想为自己的公司开发一个用于替换MySQL的产品Redis，但是没有想到他把Redis开源后大受欢迎，短短几年，Redis就有了很大的用户群体，目前国内外使用的公司有知乎网、新浪微博、GitHub等</p>
<p>&ensp;&ensp;&ensp;&ensp;redis是一个开源的、遵循BSD协议的、基于内存的而且目前比较流行的键值数据库(key-value database)，是一个非关系型数据库，redis提供将内存通过网络远程共享的一种服务，提供类似功能的还有memcache，但相比memcache，redis还提供了易扩展、高性能、具备数据持久性等功能。Redis在高并发、低延迟环境要求比较高的环境使用量非常广泛  </p>
<h3 id="2-1-2：redis对比memcached"><a href="#2-1-2：redis对比memcached" class="headerlink" title="2.1.2：redis对比memcached"></a>2.1.2：redis对比memcached</h3><p>支持数据的持久化：可以将内存中的数据保持在磁盘中，重启redis服务或者服务器之后可以从备份文件中恢复数据到内存继续使用。</p>
<p>支持更多的数据类型：支持string(字符串)、hash(哈希数据)、list(列表)、set(集合)、zet(有序集合)</p>
<p>支持数据的备份：可以实现类似于数据的master-slave模式的数据备份，另外也支持使用快照+AOF。</p>
<p>支持更大的value数据：memcache单个key value最大只支持1MB，而redis最大支持512MB。</p>
<p>Redis 是单线程，而memcache是多线程，所以单机情况下没有memcache并发高，但redis 支持分布式集群以实现更高的并发，单Redis实例可以实现数万并发。</p>
<p>支持集群横向扩展：基于redis cluster的横向扩展，可以实现分布式集群，大幅提升性能和数据安全性。</p>
<p>都是基于C语言开发。</p>
<h3 id="2-1-3：redis-典型应用场景"><a href="#2-1-3：redis-典型应用场景" class="headerlink" title="2.1.3：redis 典型应用场景"></a>2.1.3：redis 典型应用场景</h3><p>Session 共享：常见于web集群中的Tomcat或者PHP中多web服务器session共享</p>
<p>消息队列：ELK的日志缓存、部分业务的订阅发布系统</p>
<p>计数器：访问排行榜、商品浏览数等和次数相关的场景</p>
<p>缓存：数据查询、电商网站商品信息、新闻内容</p>
<p>微博/微信社交场合：共同好友、点赞评论等</p>
<h2 id="2-2：Redis安装及使用"><a href="#2-2：Redis安装及使用" class="headerlink" title="2.2：Redis安装及使用"></a>2.2：Redis安装及使用</h2><p>官方下载地址：<a href="http://download.redis.io/releases/" target="_blank" rel="noopener">http://download.redis.io/releases/</a></p>
<h3 id="2-2-1：yum安装redis"><a href="#2-2-1：yum安装redis" class="headerlink" title="2.2.1：yum安装redis"></a>2.2.1：yum安装redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#yum -y install redis</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#systemctl  start redis  端口号6379</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#systemctl  enable redis</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># redis-cli </span></span><br><span class="line">127.0.0.1:6379&gt; info</span><br></pre></td></tr></table></figure>
<h3 id="2-2-2：编译安装redis"><a href="#2-2-2：编译安装redis" class="headerlink" title="2.2.2：编译安装redis"></a>2.2.2：编译安装redis</h3><p>下载当前最新release版本redis 源码包：</p>
<h4 id="2-2-2-1：编译安装命令"><a href="#2-2-2-1：编译安装命令" class="headerlink" title="2.2.2.1：编译安装命令"></a>2.2.2.1：编译安装命令</h4><p>官方的安装命令：</p>
<p><a href="https://redis.io/download" target="_blank" rel="noopener">https://redis.io/download</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 src]<span class="comment">#pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/src</span><br><span class="line">[root@centos7 src]<span class="comment">#tar xf redis-5.0.3.tar.gz</span></span><br><span class="line">[root@centos7 src]<span class="comment">#cd redis-5.0.3</span></span><br><span class="line">[root@centos7 src]<span class="comment">#pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/src/redis-5.0.3</span><br><span class="line">[root@centos7 redis-5.0.3]<span class="comment">#make PREFIX=/usr/local/redis [MALLOC=libc] install</span></span><br><span class="line">[root@centos7 redis-5.0.3]<span class="comment">#ll /usr/local/redis/</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 2 root root 134 Dec 27 11:28 bin</span><br><span class="line">[root@centos7 redis-5.0.3]<span class="comment">#mkdir  /usr/local/redis/etc</span></span><br><span class="line">[root@centos7 redis-5.0.3]<span class="comment">#cp redis.conf  /usr/local/redis/etc/</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-2-2-2：前台启动redis"><a href="#2-2-2-2：前台启动redis" class="headerlink" title="2.2.2.2：前台启动redis"></a>2.2.2.2：前台启动redis</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 redis-5.0.3]<span class="comment">#/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-3：解决当前的警告提示"><a href="#2-2-2-3：解决当前的警告提示" class="headerlink" title="2.2.2.3：解决当前的警告提示"></a>2.2.2.3：解决当前的警告提示</h4><h5 id="2-2-2-3-1：tcp-backlog"><a href="#2-2-2-3-1：tcp-backlog" class="headerlink" title="2.2.2.3.1：tcp-backlog"></a>2.2.2.3.1：tcp-backlog</h5><p>The backlog argument defines the maximum length to which the queue of pending connections for sockfd may grow. If a connection request arrives when the queue is full, the client may receive an error with an indication of ECONNREFUSED or, if the underlying protocol supports retransmission, the request may be ignored so that a later reattempt at connection succeeds.</p>
<p>backlog参数控制的是三次握手的时候server端收到client ack确认号之后的队列值。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">  net.core.somaxconn = 512</span><br></pre></td></tr></table></figure></p>
<h5 id="2-2-2-3-2：vm-overcommit-memory"><a href="#2-2-2-3-2：vm-overcommit-memory" class="headerlink" title="2.2.2.3.2：vm.overcommit_memory"></a>2.2.2.3.2：vm.overcommit_memory</h5><p>​    0、表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。</p>
<p>​    1、表示内核允许分配所有的物理内存，而不管当前的内存状态如何。</p>
<p>​    2、表示内核允许分配超过所有物理内存和交换空间总和的内存<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">  vm.overcommit_memory = 1</span><br></pre></td></tr></table></figure></p>
<h5 id="2-2-2-3-3：transparent-hugepage"><a href="#2-2-2-3-3：transparent-hugepage" class="headerlink" title="2.2.2.3.3：transparent hugepage"></a>2.2.2.3.3：transparent hugepage</h5><p>开启大页内存动态分配，需要关闭让redis 负责内存管理。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure></p>
<h4 id="2-2-2-4：编辑redis服务启动脚本"><a href="#2-2-2-4：编辑redis服务启动脚本" class="headerlink" title="2.2.2.4：编辑redis服务启动脚本"></a>2.2.2.4：编辑redis服务启动脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#vim /usr/lib/systemd/system/redis.service</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis persistent key-value database</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/redis/bin/redis-server /usr/<span class="built_in">local</span>/redis/etc/redis.conf  --supervised systemd</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span> </span><br><span class="line">ExecStop=/bin/<span class="built_in">kill</span> -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">Type=notify</span><br><span class="line">User=redis</span><br><span class="line">Group=redis</span><br><span class="line">RuntimeDirectory=redis</span><br><span class="line">RuntimeDirectoryMode=0755</span><br><span class="line"> </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-5：创建redis-用户和数据目录"><a href="#2-2-2-5：创建redis-用户和数据目录" class="headerlink" title="2.2.2.5：创建redis 用户和数据目录"></a>2.2.2.5：创建redis 用户和数据目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#groupadd  -g 1000 redis &amp;&amp; useradd   -u 1000 -g 1000 redis -s /sbin/nologin</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#mkdir -pv /usr/local/redis/&#123;logs,data,run&#125;</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#chown redis.redis -R  /usr/local/redis/</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-6：创建命令软连接"><a href="#2-2-2-6：创建命令软连接" class="headerlink" title="2.2.2.6：创建命令软连接"></a>2.2.2.6：创建命令软连接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#ln -sv /usr/local/redis/bin/redis-* /usr/bin/</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-7：重启redis服务"><a href="#2-2-2-7：重启redis服务" class="headerlink" title="2.2.2.7：重启redis服务"></a>2.2.2.7：重启redis服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#systemctl restart redis</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-8：使用客户端连接redis"><a href="#2-2-2-8：使用客户端连接redis" class="headerlink" title="2.2.2.8：使用客户端连接redis"></a>2.2.2.8：使用客户端连接redis</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#/usr/local/redis/bin/redis-cli -h IP</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-9：编译安装后的命令"><a href="#2-2-2-9：编译安装后的命令" class="headerlink" title="2.2.2.9：编译安装后的命令"></a>2.2.2.9：编译安装后的命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@redis-s1 ~]<span class="comment"># ll /usr/local/redis/bin/</span></span><br><span class="line">total 32656</span><br><span class="line">-rwxr-xr-x 1 redis redis 4365488 Dec 13 09:21 redis-benchmark <span class="comment">#redis性能测试工具</span></span><br><span class="line">-rwxr-xr-x 1 redis redis 8088920 Dec 13 09:21 redis-check-aof <span class="comment">#AOF文件检查工具</span></span><br><span class="line">-rwxr-xr-x 1 redis redis 8088920 Dec 13 09:21 redis-check-rdb <span class="comment">#RDB文件检查工具</span></span><br><span class="line">-rwxr-xr-x 1 redis redis 4800752 Dec 13 09:21 redis-cli <span class="comment">#redis #客户端工具</span></span><br><span class="line">lrwxrwxrwx 1 redis redis   12 Dec 13 09:21 redis-sentinel -&gt; redis-server <span class="comment">#哨兵，软连接到server</span></span><br><span class="line">-rwxr-xr-x 1 redis redis 8088920 Dec 13 09:21  <span class="comment">#redis-server #redis 服务端</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-3：连接到Redis"><a href="#2-2-3：连接到Redis" class="headerlink" title="2.2.3：连接到Redis"></a>2.2.3：连接到Redis</h3><p>主要分为运维人员的连接和程序的连接  </p>
<h4 id="2-2-3-1：本机非密码连接"><a href="#2-2-3-1：本机非密码连接" class="headerlink" title="2.2.3.1：本机非密码连接"></a>2.2.3.1：本机非密码连接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-2：跨主机非密码连接"><a href="#2-2-3-2：跨主机非密码连接" class="headerlink" title="2.2.3.2：跨主机非密码连接"></a>2.2.3.2：跨主机非密码连接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli  -h HOSTNAME/IP  -p PORT</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-3：跨主机密码连接"><a href="#2-2-3-3：跨主机密码连接" class="headerlink" title="2.2.3.3：跨主机密码连接"></a>2.2.3.3：跨主机密码连接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli  -h HOSTNAME/IP  -p PORT  -a  PASSWORD</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-4：python连接方式"><a href="#2-2-3-4：python连接方式" class="headerlink" title="2.2.3.4：python连接方式"></a>2.2.3.4：python连接方式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/env  python</span></span><br><span class="line"><span class="comment">#Author: ZhangJie</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span>  time</span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">"192.168.7.101"</span>, port=<span class="number">6379</span>,password=<span class="string">""</span>)</span><br><span class="line">r = redis.Redis(connection_pool=pool)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    r.set(<span class="string">"k%d"</span> % i,<span class="string">"v%d"</span> % i)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    data=r.get(<span class="string">"k%d"</span> % i)</span><br><span class="line">    print(data)</span><br></pre></td></tr></table></figure>
<h1 id="三：redis配置文件"><a href="#三：redis配置文件" class="headerlink" title="三：redis配置文件"></a>三：redis配置文件</h1><ul>
<li>基本配置项</li>
<li>网络配置项</li>
<li>持久化相关配置</li>
<li>复制相关的配置</li>
<li>安全相关配置</li>
<li>Limit相关的配置</li>
<li>SlowLog相关的配置</li>
<li>INCLUDES</li>
<li>Advanced配置</li>
</ul>
<h2 id="3-1：网络配置项"><a href="#3-1：网络配置项" class="headerlink" title="3.1：网络配置项"></a>3.1：网络配置项</h2><p><strong>bind 0.0.0.0</strong>        #监听地址，可以用空格隔开后多个监听IP</p>
<p><strong>protected-mode yes</strong>      #redis3.2 之后加入的新特性，在没有设置bind IP和密码的时候只允许访问127.0.0.1:6379</p>
<p><strong>port 6379</strong>     #监听端口</p>
<p><strong>tcp-backlog 511</strong>     #三次握手的时候server端收到client ack确认号之后的队列值。</p>
<p><strong>timeout 0</strong>     #客户端和Redis服务端的连接超时时间，默认是0，表示永不超时。 </p>
<p><strong>tcp-keepalive 300</strong>     #tcp 会话保持时间</p>
<h2 id="3-2：通用配置项"><a href="#3-2：通用配置项" class="headerlink" title="3.2：通用配置项"></a>3.2：通用配置项</h2><p><strong>daemonize no</strong>     #认情况下 redis 不是作为守护进程运行的，如果你想让它在后台运行，你就把它改成 yes,当redis作为守护进程运行的时候，它会写一个 pid 到 /var/run/redis.pid 文件里面</p>
<p><strong>supervised no</strong>     #和操作系统相关参数，可以设置通过upstart和systemd管理Redis守护进程，centos 7以后都使用systemd</p>
<p><strong>pidfile /var/run/redis_6379.pid</strong>        #pid文件路径</p>
<p><strong>loglevel notice</strong>     #日志级别</p>
<p><strong>logfile “”</strong>     #日志路径</p>
<p><strong>databases 16</strong>      #设置db 库数量，默认16个库</p>
<p><strong>always-show-logo yes</strong>     #在启动redis 时是否显示log</p>
<h2 id="3-3：快照配置项"><a href="#3-3：快照配置项" class="headerlink" title="3.3：快照配置项"></a>3.3：快照配置项</h2><p><strong>save 900 1</strong>     #在900秒内有一个键内容发生更改就出就快照机制</p>
<p><strong>save 300 10</strong></p>
<p><strong>save 60 10000</strong></p>
<p><strong>stop-writes-on-bgsave-error yes</strong>      #快照出错时是否禁止redis 写入操作</p>
<p><strong>rdbcompression yes</strong>     #持久化到RDB文件时，是否压缩，”yes”为压缩，”no”则反之</p>
<p><strong>rdbchecksum yes</strong>      #是否开启RC64校验，默认是开启</p>
<p><strong>dbfilename dump.rdb</strong>     #快照文件名</p>
<p><strong>dir ./</strong>     #快照文件保存路径​                                              </p>
<h2 id="3-4：复制相关的配置"><a href="#3-4：复制相关的配置" class="headerlink" title="3.4：复制相关的配置"></a>3.4：复制相关的配置</h2><p><strong>slave-serve-stale-data yes</strong>    #当从库同主库失去连接或者复制正在进行，从机库有两种运行方式：</p>
<ul>
<li>如果slave-serve-stale-data设置为yes(默认设置)，从库会继续响应客户端的请求;</li>
<li>如果slave-serve-stale-data设置为no，除去指定的命令之外的任何请求都会返回一个错误”SYNC with master in progress”。</li>
</ul>
<p><strong>slave-read-only yes</strong>    #是否设置从库只读</p>
<p><strong>repl-diskless-sync no</strong>    #是否使用socket方式复制数据，目前redis复制提供两种方式，disk和socket，如果新的slave连上来或者重连的slave无法部分同步，就会执行全量同步，master会生成rdb文件，有2种方式：</p>
<ol>
<li>disk方式是master创建一个新的进程把rdb文件保存到磁盘，再把磁盘上的rdb文件传递给slave </li>
<li><p>socket是master创建一个新的进程，直接把rdb文件以socket的方式发给slave，</p>
</li>
<li><p>disk方式的时候，当一个rdb保存的过程中，多个slave都能共享这个rdb文件，</p>
</li>
<li>socket的方式就是一个个slave顺序复制，只有在磁盘速度缓慢但是网络相对较快的情况下才使用socket方式，否则使用默认的disk方式</li>
</ol>
<p><strong>repl-diskless-sync-delay 5</strong>    #diskless复制的延迟时间，设置0为关闭，一旦复制开始还没有结束之前，master节点不会再接收新slave的复制请求，直到下一次开始</p>
<p><strong>repl-ping-slave-period 10</strong>        #slave根据master指定的时间进行周期性的PING 监测</p>
<p><strong>repl-timeout 60</strong>    #复制链接超时时间，需要大于repl-ping-slave-period，否则会经常报超时</p>
<p><strong>repl-disable-tcp-nodelay no</strong>     #在socket模式下是否在slave套接字发送SYNC之后禁用 TCP_NODELAY，</p>
<ul>
<li>如果你选择“yes”Redis将使用更少的TCP包和带宽来向slaves发送数据。但是这将使数据传输到slave上有延迟，Linux内核的默认配置会达到40毫秒;</li>
<li>如果你选择了 “no” 数据传输到salve的延迟将会减少但要使用更多的带宽</li>
</ul>
<p><strong>repl-backlog-size 1mb</strong>     #复制缓冲区大小，只有在slave连接之后才分配内存。 </p>
<p><strong>repl-backlog-ttl 3600</strong>        #多次时间master没有slave连接，就清空backlog缓冲区。</p>
<p><strong>slave-priority 100</strong>     #当master不可用，Sentinel会根据slave的优先级选举一个master。最低的优先级的slave，当选master。而配置成0，永远不会被选举。</p>
<h2 id="3-5：安全相关配置"><a href="#3-5：安全相关配置" class="headerlink" title="3.5：安全相关配置"></a>3.5：安全相关配置</h2><p><strong>requirepass foobared</strong>     #设置redis 连接密码</p>
<p><strong>rename-command</strong>     #重命名一些高危命令</p>
<h2 id="3-6：Limit相关的配置"><a href="#3-6：Limit相关的配置" class="headerlink" title="3.6：Limit相关的配置"></a>3.6：Limit相关的配置</h2><p><strong>maxclients 10000</strong>     #最大连接客户端</p>
<p><strong>maxmemory</strong>     #最大内存，单位为bytes字节，8G内存的计算方式<br>$$<br>8(G)<em>1024(MB)</em>1024(KB)*1024(Kbyte)<br>$$<br>需要注意的是slave的输出缓冲区是不计算在maxmemory内。</p>
<h2 id="3-7：APPEND-ONLY-MODE"><a href="#3-7：APPEND-ONLY-MODE" class="headerlink" title="3.7：APPEND ONLY MODE"></a>3.7：APPEND ONLY MODE</h2><p><strong>appendonly no</strong>     #是否开启AOF日志记录，默认 redis 使用的是 rdb 方式持久化，这种方式在许多应用中已经足够用了。但是 redis 如果中途宕机，会导致可能有几分钟的数据丢失，根据 save 来策略进行持久化，Append Only File 是另一种持久化方式，可以提供更好的持久化特性。Redis 会把每次写入的数据在接收后都写入 appendonly.aof  文件，每次启动时 Redis 都会先把这个文件的数据读入内存里，先忽略 RDB 文件。</p>
<p><strong>appendfilename “appendonly.aof”</strong>     #AOF文件名</p>
<p><strong>appendfsync everysec</strong>    #aof 持久化策略的配置；</p>
<ol>
<li>no 表示不执行fsync,由操作系统保证数据同步到磁盘；</li>
<li>always表示每次写入都执行fsync，以保证数据同步到磁盘；</li>
<li>everysec表示每秒执行一次fsync，可能会导致丢失这1s数据。</li>
</ol>
<p><strong>no-appendfsync-on-rewrite no</strong>         #在aof rewrite期间,是否对aof新记录的append暂缓使用文件同步策略,主要考虑磁盘IO开支和请求阻塞时间。默认为no,表示”不暂缓”,新的aof记录仍然会被立即同步，Linux的默认fsync策略是30秒，如果为yes 可能丢失30秒数据，但由于yes性能较好而且会避免出现阻塞因此比较推荐。</p>
<p><strong>auto-aof-rewrite-percentage 100</strong>     # 当Aof log增长超过指定比例时，重写log file， 设置为0表示不自动重写Aof 日志，重写是为了使aof体积保持最小，而确保保存最完整的数据。</p>
<p><strong>auto-aof-rewrite-min-size 64mb</strong>     #触发aof rewrite的最小文件尺寸</p>
<p><strong>aof-load-truncated yes</strong>     #是否加载由于其他原因导致的末尾异常的AOF文件(主进程被kill/断电等)</p>
<p><strong>aof-use-rdb-preamble yes</strong>    #redis4.0新增RDB-AOF混合持久化格式，在开启了这个功能之后，AOF重写产生的文件将同时包含RDB格式的内容和AOF格式的内容，其中RDB格式的内容用于记录已有的数据，而AOF格式的内存则用于记录最近发生了变化的数据，这样Redis就可以同时兼有RDB持久化和AOF持久化的优点（既能够快速地生成重写文件，也能够在出现问题时，快速地载入数据）。</p>
<h2 id="3-8：-LUA-SCRIPTING"><a href="#3-8：-LUA-SCRIPTING" class="headerlink" title="3.8： LUA SCRIPTING"></a>3.8： LUA SCRIPTING</h2><p><strong>lua-time-limit 5000</strong>     #lua脚本的最大执行时间，单位为毫秒</p>
<h2 id="3-9：-REDIS-CLUSTER"><a href="#3-9：-REDIS-CLUSTER" class="headerlink" title="3.9： REDIS CLUSTER"></a>3.9： REDIS CLUSTER</h2><p><strong>cluster-enabled yes</strong>     #是否开启集群模式，默认是单机模式</p>
<p><strong>cluster-config-file nodes-6379.conf</strong>        #由node节点自动生成和的集群配置文件</p>
<p><strong>cluster-node-timeout 15000</strong>     #集群中node节点连接超时时间</p>
<p><strong>cluster-replica-validity-factor 10</strong>     #在执行故障转移的时候可能有些节点和master断开一段时间数据比较旧，这些节点就不适用于选举为master，超过这个时间的就不会被进行故障转移</p>
<p><strong>cluster-migration-barrier 1</strong>      #一个主节点拥有的至少正常工作的从节点，即如果主节点的slave节点故障后会将多余的从节点分配到当前主节点成为其新的从节点。</p>
<p><strong>cluster-require-full-coverage yes</strong>     #集群槽位覆盖，如果一个主库宕机且没有备库就会出现集群槽位不全，那么yes情况下redis集群槽位验证不全就不再对外提供服务，而no则可以继续使用但是会出现查询数据查不到的情况(因为有数据丢失)。</p>
<p><strong>cluster-replica-no-failover no</strong></p>
<h2 id="3-10：-SLOW-LOG"><a href="#3-10：-SLOW-LOG" class="headerlink" title="3.10： SLOW LOG"></a>3.10： SLOW LOG</h2><p>&ensp;&ensp;&ensp;&ensp;Slow log 是 Redis 用来记录查询执行时间的日志系统，slow log 保存在内存里面，读写速度非常快，因此你可以放心地使用它，不必担心因为开启 slow log 而损害 Redis 的速度。</p>
<p><strong>slowlog-log-slower-than 10000</strong>     #以微秒为单位的慢日志记录，为负数会禁用慢日志，为0会记录每个命令操作。</p>
<p><strong>slowlog-max-len 128</strong>        #记录多少条慢日志保存在队列，超出后会删除最早的，以此滚动删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; slowlog len</span><br><span class="line"></span><br><span class="line">(integer) 14</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; slowlog get</span><br><span class="line"></span><br><span class="line">(integer) 14</span><br><span class="line"></span><br><span class="line">(integer) 1544690617</span><br><span class="line"></span><br><span class="line">(integer) 4</span><br><span class="line"></span><br><span class="line">&quot;slowlog&quot;</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SLOWLOG reset</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h2 id="3-2：redis持久化"><a href="#3-2：redis持久化" class="headerlink" title="3.2：redis持久化"></a>3.2：redis持久化</h2><p>&ensp;&ensp;&ensp;&ensp;redis 虽然是一个内存级别的缓存程序，即redis 是使用内存进行数据的缓存的，但是其可以将内存的数据按照一定的策略保存到硬盘上，从而实现数据持久保存的目的，redis支持两种不同方式的数据持久化保存机制，分别是RDB和AOF</p>
<h3 id="3-2-1：RDB模式"><a href="#3-2-1：RDB模式" class="headerlink" title="3.2.1：RDB模式"></a>3.2.1：RDB模式</h3><p>RDB：基于时间的快照，只保留当前最新的一次快照，特点是执行速度比较快，缺点是可能会丢失从上次快照到当前快照未完成之间的数据。</p>
<p>&ensp;&ensp;&ensp;&ensp;RDB实现的具体过程Redis从主进程先fork出一个子进程，使用写时复制机制，子进程将内存的数据保存为一个临时文件，比如dump.rdb.temp，当数据保存完成之后再将上一次保存的RDB文件替换掉，然后关闭子进程，这样可以保存每一次做RDB快照的时候保存的数据都是完整的，因为直接替换RDB文件的时候可能会出现突然断电等问题而导致RDB文件还没有保存完整就突然关机停止保存而导致数据丢失的情况，可以手动将每次生成的RDB文件进程备份，这样可以最大化保存历史数据。  </p>
<h3 id="3-2-2：RDB模式的优缺点"><a href="#3-2-2：RDB模式的优缺点" class="headerlink" title="3.2.2：RDB模式的优缺点"></a>3.2.2：RDB模式的优缺点</h3><p>优点：</p>
<ol>
<li>RDB快照保存了某个时间点的数据，可以通过脚本执行bgsave(非阻塞)或者save(阻塞)命令自定义时间点北备份，可以保留多个备份，当出现问题可以恢复到不同时间点的版本。  </li>
<li>可以最大化o的性能，因为父进程在保存RDB 文件的时候唯一要做的是fork出一个子进程，然后的-操作都会有这个子进程操作，父进程无需任何的IO操作  </li>
<li>RDB在大量数据比如几个G的数据，恢复的速度比AOF的快  </li>
</ol>
<p>缺点：</p>
<ol>
<li>不能时时的保存数据，会丢失自上一次执行RDB备份到当前的内存数据  </li>
<li>数据量非常大的时候，从父进程fork的时候需要一点时间，可能是毫秒或者秒  </li>
</ol>
<h3 id="3-2-3：AOF模式"><a href="#3-2-3：AOF模式" class="headerlink" title="3.2.3：AOF模式"></a>3.2.3：AOF模式</h3><p>AOF:按照操作顺序依次将操作添加到指定的日志文件当中，特点是数据安全性相对较高，缺点是即使有些操作是重复的也会全部记录。</p>
<p>&ensp;&ensp;&ensp;&ensp;AOF和RDB一样使用了写时复制机制，AOF默认为每秒钟fsync一次，即将执行的命令保存到AOF文件当中，这样即使redis服务器发生故障的话顶多也就丢失1秒钟之内的数据，也可以设置不同的fsync策略，或者设置每次执行命令的时候执行fsync，fsync会在后台执行线程，所以主线程可以继续处理用户的正常请求而不受到写入AOF文件的IO影响</p>
<h3 id="3-2-4：AOF模式优缺点"><a href="#3-2-4：AOF模式优缺点" class="headerlink" title="3.2.4：AOF模式优缺点"></a>3.2.4：AOF模式优缺点</h3><ol>
<li>AOF的文件大小要大于RDB格式的文件  </li>
<li>根据所使用的fsync策略(fsync是同步内存中redis所有已经修改的文件到存储设备)，默认是appendfsync everysec即每秒执行一次fsync</li>
</ol>
<h1 id="四：redis-数据类型"><a href="#四：redis-数据类型" class="headerlink" title="四：redis 数据类型"></a>四：redis 数据类型</h1><h2 id="4-1：字符串-string"><a href="#4-1：字符串-string" class="headerlink" title="4.1：字符串(string)"></a>4.1：字符串(string)</h2><p>&ensp;&ensp;&ensp;&ensp;字符串是所有编程语言中最常见的和最常用的数据类型，而且也是redis最基本的数据类型之一，而且redis中所有的key的类型都是字符串。  </p>
<h3 id="4-1-1：添加一个key"><a href="#4-1-1：添加一个key" class="headerlink" title="4.1.1：添加一个key"></a>4.1.1：添加一个key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key1 value1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">type</span> key1</span><br><span class="line">string</span><br></pre></td></tr></table></figure>
<h3 id="4-1-2：获取一个key的内容"><a href="#4-1-2：获取一个key的内容" class="headerlink" title="4.1.2：获取一个key的内容"></a>4.1.2：获取一个key的内容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line"><span class="string">"value1"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-1-3：删除一个key"><a href="#4-1-3：删除一个key" class="headerlink" title="4.1.3：删除一个key"></a>4.1.3：删除一个key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; del key1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<h3 id="4-1-4：批量设置多个key"><a href="#4-1-4：批量设置多个key" class="headerlink" title="4.1.4：批量设置多个key"></a>4.1.4：批量设置多个key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MSET key1 value1 key2 value2</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h3 id="4-1-5：批量获取多个key"><a href="#4-1-5：批量获取多个key" class="headerlink" title="4.1.5：批量获取多个key"></a>4.1.5：批量获取多个key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MSET key1 value1 key2 value2</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h3 id="4-1-6：追加数据"><a href="#4-1-6：追加数据" class="headerlink" title="4.1.6：追加数据"></a>4.1.6：追加数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; APPEND key1 append</span><br><span class="line">(<span class="built_in">integer</span>) 12</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line"><span class="string">"value1append"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-1-7：数值递增"><a href="#4-1-7：数值递增" class="headerlink" title="4.1.7：数值递增"></a>4.1.7：数值递增</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> num 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; INCR num</span><br><span class="line">(<span class="built_in">integer</span>) 11</span><br><span class="line">127.0.0.1:6379&gt; get num</span><br><span class="line"><span class="string">"11"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-1-8：数值递减"><a href="#4-1-8：数值递减" class="headerlink" title="4.1.8：数值递减"></a>4.1.8：数值递减</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> num 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decr num</span><br><span class="line">(<span class="built_in">integer</span>) 9</span><br><span class="line">127.0.0.1:6379&gt; get num</span><br><span class="line"><span class="string">"9"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-1-9：返回字符串key长度"><a href="#4-1-9：返回字符串key长度" class="headerlink" title="4.1.9：返回字符串key长度"></a>4.1.9：返回字符串key长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; strlen key1</span><br><span class="line">(<span class="built_in">integer</span>) 12</span><br></pre></td></tr></table></figure>
<h2 id="4-2：列表-list"><a href="#4-2：列表-list" class="headerlink" title="4.2：列表(list)"></a>4.2：列表(list)</h2><p>&ensp;&ensp;&ensp;&ensp;列表是一个双向可读写的管道，其头部是左侧尾部是右侧，一个列表最多可以包含2^32-1个元素即4294967295个元素。</p>
<h3 id="4-2-1：生成列表并插入数据"><a href="#4-2-1：生成列表并插入数据" class="headerlink" title="4.2.1：生成列表并插入数据"></a>4.2.1：生成列表并插入数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LPUSH list1 jack</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; TYPE list1</span><br><span class="line">list</span><br></pre></td></tr></table></figure>
<h3 id="4-2-2：向列表追加数据"><a href="#4-2-2：向列表追加数据" class="headerlink" title="4.2.2：向列表追加数据"></a>4.2.2：向列表追加数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LPUSH list1 tom</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; RPUSH list1 jack</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>
<h3 id="4-2-3：获取列表长度"><a href="#4-2-3：获取列表长度" class="headerlink" title="4.2.3：获取列表长度"></a>4.2.3：获取列表长度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LLEN list1</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>
<h3 id="4-2-4：移除列表数据"><a href="#4-2-4：移除列表数据" class="headerlink" title="4.2.4：移除列表数据"></a>4.2.4：移除列表数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; RPOP list1 <span class="comment">#最后一个</span></span><br><span class="line"><span class="string">"jack"</span></span><br><span class="line">127.0.0.1:6379&gt; LPOP list1 <span class="comment">#第一个</span></span><br><span class="line"><span class="string">"tom"</span></span><br></pre></td></tr></table></figure>
<h2 id="4-3：集合-set"><a href="#4-3：集合-set" class="headerlink" title="4.3：集合(set)"></a>4.3：集合(set)</h2><p>&ensp;&ensp;&ensp;&ensp;Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。</p>
<h3 id="4-3-1：生成集合key"><a href="#4-3-1：生成集合key" class="headerlink" title="4.3.1：生成集合key"></a>4.3.1：生成集合key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SADD set1 v1 </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; SADD set2 v2 v4</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; TYPE set1</span><br><span class="line"><span class="built_in">set</span></span><br><span class="line">127.0.0.1:6379&gt; TYPE set2</span><br><span class="line"><span class="built_in">set</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-2：追加数值"><a href="#4-3-2：追加数值" class="headerlink" title="4.3.2：追加数值"></a>4.3.2：追加数值</h3><p>追加的时候不能追加已经存在的数值<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SADD set1 v2 v3 v4</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; SADD set1 v2 <span class="comment">#没有追加成功</span></span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; TYPE set1</span><br><span class="line"><span class="built_in">set</span></span><br><span class="line">127.0.0.1:6379&gt; TYPE set2</span><br><span class="line"><span class="built_in">set</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-3-3：查看集合的所有数据"><a href="#4-3-3：查看集合的所有数据" class="headerlink" title="4.3.3：查看集合的所有数据"></a>4.3.3：查看集合的所有数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SMEMBERS set1</span><br><span class="line">1) <span class="string">"v4"</span></span><br><span class="line">2) <span class="string">"v1"</span></span><br><span class="line">3) <span class="string">"v3"</span></span><br><span class="line">4) <span class="string">"v2"</span></span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS set2</span><br><span class="line">1) <span class="string">"v4"</span></span><br><span class="line">2) <span class="string">"v2"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-2-4：获取集合的差集"><a href="#4-2-4：获取集合的差集" class="headerlink" title="4.2.4：获取集合的差集"></a>4.2.4：获取集合的差集</h3><p>差集：已属于A而不属于B的元素称为A与B的差（集）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SDIFF set1 set2</span><br><span class="line">1) <span class="string">"v1"</span></span><br><span class="line">2) <span class="string">"v3"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-3-5：获取集合的交集"><a href="#4-3-5：获取集合的交集" class="headerlink" title="4.3.5：获取集合的交集"></a>4.3.5：获取集合的交集</h3><p>交集：已属于A且属于B的元素称为A与B的交（集）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SINTER set1 set2</span><br><span class="line">1) <span class="string">"v4"</span></span><br><span class="line">2) <span class="string">"v2"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-3-6：获取集合的并集"><a href="#4-3-6：获取集合的并集" class="headerlink" title="4.3.6：获取集合的并集"></a>4.3.6：获取集合的并集</h3><p>并集：已属于A或属于B的元素为称为A与B的并（集）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUNION  set1 set2</span><br><span class="line">1) <span class="string">"v2"</span></span><br><span class="line">2) <span class="string">"v4"</span></span><br><span class="line">3) <span class="string">"v1"</span></span><br><span class="line">4) <span class="string">"v3"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-4：sorted-set-有序集合"><a href="#4-4：sorted-set-有序集合" class="headerlink" title="4.4：sorted set(有序集合)"></a>4.4：sorted set(有序集合)</h2><p>&ensp;&ensp;&ensp;&ensp;Redis 有序集合和集合一样也是string类型元素的集合,且不允许重复的成员，不同的是每个元素都会关联一个double(双精度浮点型)类型的分数，redis正是通过分数来为集合中的成员进行从小到大的排序，序集合的成员是唯一的,但分数(score)却可以重复，集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)， 集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。</p>
<h3 id="4-4-1：生成有序集合"><a href="#4-4-1：生成有序集合" class="headerlink" title="4.4.1：生成有序集合"></a>4.4.1：生成有序集合</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD zset1 1 v1 </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD zset1 2 v2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD zset1 2 v3</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ZADD zset1 3 v4</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; TYPE zset1</span><br><span class="line">zset</span><br><span class="line">127.0.0.1:6379&gt; TYPE zset2</span><br><span class="line">none</span><br></pre></td></tr></table></figure>
<p>排行案例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">192.168.7.104:6379&gt; ZADD paihangbang 10 key1 20 key2 30 key3</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">192.168.7.104:6379&gt; ZREVRANGE paihangbang 0 -1 withscores</span><br><span class="line">1) <span class="string">"key3"</span></span><br><span class="line">2) <span class="string">"30"</span></span><br><span class="line">3) <span class="string">"key2"</span></span><br><span class="line">4) <span class="string">"20"</span></span><br><span class="line">5) <span class="string">"key1"</span></span><br><span class="line">6) <span class="string">"10"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-2：批量添加多个数值"><a href="#4-4-2：批量添加多个数值" class="headerlink" title="4.4.2：批量添加多个数值"></a>4.4.2：批量添加多个数值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZADD zset2 1 v1 2 v2 4 v3 5 v5</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure>
<h3 id="4-4-3：获取集合的长度数"><a href="#4-4-3：获取集合的长度数" class="headerlink" title="4.4.3：获取集合的长度数"></a>4.4.3：获取集合的长度数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZCARD zset1 </span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; ZCARD zset2</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure>
<h3 id="4-4-4：基于索引返回数值"><a href="#4-4-4：基于索引返回数值" class="headerlink" title="4.4.4：基于索引返回数值"></a>4.4.4：基于索引返回数值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZRANGE zset1 1 3</span><br><span class="line">1) <span class="string">"v2"</span></span><br><span class="line">2) <span class="string">"v3"</span></span><br><span class="line">3) <span class="string">"v4"</span></span><br><span class="line">127.0.0.1:6379&gt; ZRANGE zset1 0 2</span><br><span class="line">1) <span class="string">"v1"</span></span><br><span class="line">2) <span class="string">"v2"</span></span><br><span class="line">3) <span class="string">"v3"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-4-5：返回某个数值的索引"><a href="#4-4-5：返回某个数值的索引" class="headerlink" title="4.4.5：返回某个数值的索引"></a>4.4.5：返回某个数值的索引</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; ZRANK zset1 v2</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ZRANK zset1 v3</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>
<h2 id="4-5：哈希-hash"><a href="#4-5：哈希-hash" class="headerlink" title="4.5：哈希(hash)"></a>4.5：哈希(hash)</h2><p>&ensp;&ensp;&ensp;&ensp;hash 是一个string类型的field和value的映射表，hash特别适合用于存储对象,Redis 中每个 hash 可以存储 232 - 1 键值对（40多亿）。</p>
<h3 id="4-5-1：生成hash-key"><a href="#4-5-1：生成hash-key" class="headerlink" title="4.5.1：生成hash key"></a>4.5.1：生成hash key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HSET hset1 name tom </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; HSET hset1 age 18</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">或者	127.0.0.1:6379&gt; HMSET hset1 name tom age 18</span><br><span class="line">127.0.0.1:6379&gt; TYPE hset1</span><br><span class="line"><span class="built_in">hash</span></span><br></pre></td></tr></table></figure>
<h3 id="4-5-2：获取hash-key字段值"><a href="#4-5-2：获取hash-key字段值" class="headerlink" title="4.5.2：获取hash key字段值"></a>4.5.2：获取hash key字段值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HGET hset1 name</span><br><span class="line"><span class="string">"tom"</span></span><br><span class="line">127.0.0.1:6379&gt; HGET hset1  age</span><br><span class="line"><span class="string">"18"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-5-3：删除一个hash-key的字段"><a href="#4-5-3：删除一个hash-key的字段" class="headerlink" title="4.5.3：删除一个hash key的字段"></a>4.5.3：删除一个hash key的字段</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HDEL hset1 age</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<h3 id="4-5-4：获取所有hash表中的字段"><a href="#4-5-4：获取所有hash表中的字段" class="headerlink" title="4.5.4：获取所有hash表中的字段"></a>4.5.4：获取所有hash表中的字段</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; HMSET hset1 name tom age 19</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; HKEYS hset1</span><br><span class="line">1) <span class="string">"name"</span></span><br><span class="line">2) <span class="string">"age"</span></span><br></pre></td></tr></table></figure>
<h1 id="五：消息队列"><a href="#五：消息队列" class="headerlink" title="五：消息队列"></a>五：消息队列</h1><p>&ensp;&ensp;&ensp;&ensp;消息队列主要分为两种，分别是生产者消费者模式和发布者订阅者模式，这两种模式Redis都支持。</p>
<h2 id="5-1：生产者消费者模式"><a href="#5-1：生产者消费者模式" class="headerlink" title="5.1：生产者消费者模式"></a>5.1：生产者消费者模式</h2><p>&ensp;&ensp;&ensp;&ensp;在生产者消费者(Producer/Consumer)模式下，上层应用接收到的外部请求后开始处理其当前步骤的操作，在执行完成后将已经完成的操作发送至指定的频道(channel)当中，并由其下层的应用监听该频道并继续下一步的操作，如果其处理完成后没有下一步的操作就直接返回数据给外部请求，如果还有下一步的操作就再将任务发布到另外一个频道，由另外一个消费者继续监听和处理。</p>
<h3 id="5-1-1：模式介绍"><a href="#5-1-1：模式介绍" class="headerlink" title="5.1.1：模式介绍"></a>5.1.1：模式介绍</h3><p>&ensp;&ensp;&ensp;&ensp;生产者消费者模式下，多个消费者同时监听一个队里，但是一个消息只能被最先抢到消息的消费者消费，即消息任务是一次性读取和处理，此模式在分布式业务架构中非常常用，比较常用的软件还有RabbitMQ、Kafka、RocketMQ、ActiveMQ等  </p>
<h3 id="5-1-2：队列介绍"><a href="#5-1-2：队列介绍" class="headerlink" title="5.1.2：队列介绍"></a>5.1.2：队列介绍</h3><p>&ensp;&ensp;&ensp;&ensp;队列当中的 消息由不同的生产者写入也会有不同的消费者取出进行消费处理，但是买一个消息一定是只能被取出一次也就是被消费一次。  </p>
<h3 id="5-1-3：生产者发布消息"><a href="#5-1-3：生产者发布消息" class="headerlink" title="5.1.3：生产者发布消息"></a>5.1.3：生产者发布消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; AUTH 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LPUSH channel1 msg1 <span class="comment">#从管道的左侧写入</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; LPUSH channel1 msg2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; LPUSH channel1 msg3</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; LPUSH channel1 msg4</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; LPUSH channel1 msg5</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure>
<h3 id="5-1-4：查看队列所有消息"><a href="#5-1-4：查看队列所有消息" class="headerlink" title="5.1.4：查看队列所有消息"></a>5.1.4：查看队列所有消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LRANGE channel1  0  -1</span><br><span class="line">1) <span class="string">"msg5"</span></span><br><span class="line">2) <span class="string">"msg4"</span></span><br><span class="line">3) <span class="string">"msg3"</span></span><br><span class="line">4) <span class="string">"msg2"</span></span><br><span class="line">5) <span class="string">"msg1"</span></span><br></pre></td></tr></table></figure>
<h3 id="5-1-5：消费者消费消息"><a href="#5-1-5：消费者消费消息" class="headerlink" title="5.1.5：消费者消费消息"></a>5.1.5：消费者消费消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; RPOP channel1 <span class="comment">#从管道的右侧消费</span></span><br><span class="line"><span class="string">"msg1"</span></span><br><span class="line">127.0.0.1:6379&gt; RPOP channel1</span><br><span class="line"><span class="string">"msg2"</span></span><br><span class="line">127.0.0.1:6379&gt; RPOP channel1</span><br><span class="line"><span class="string">"msg3"</span></span><br><span class="line">127.0.0.1:6379&gt; RPOP channel1</span><br><span class="line"><span class="string">"msg4"</span></span><br><span class="line">127.0.0.1:6379&gt; RPOP channel1</span><br><span class="line"><span class="string">"msg5"</span></span><br><span class="line">127.0.0.1:6379&gt; RPOP channel1</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<h3 id="5-1-6：再次验证队列消息"><a href="#5-1-6：再次验证队列消息" class="headerlink" title="5.1.6：再次验证队列消息"></a>5.1.6：再次验证队列消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;  LRANGE channel1  0  -1 </span><br><span class="line">(empty list or <span class="built_in">set</span>)  <span class="comment">#队列中的消息已经被已全部消费完毕</span></span><br></pre></td></tr></table></figure>
<h2 id="5-2：发布者订阅模式"><a href="#5-2：发布者订阅模式" class="headerlink" title="5.2：发布者订阅模式"></a>5.2：发布者订阅模式</h2><h3 id="5-2-1：模式简介"><a href="#5-2-1：模式简介" class="headerlink" title="5.2.1：模式简介"></a>5.2.1：模式简介</h3><p>&ensp;&ensp;&ensp;&ensp;在发布者订阅者模式下，发布者将消息发布到指定的channel里面，凡是监听该channel的消费者都会收到同样的一份消息，这种模式类似于是收音机模式，即凡是收听某个频道的听众都会收到主持人发布的相同的消息内容。</p>
<p>此模式常用语群聊天、群通知、群公告等场景。</p>
<p>Subscriber：订阅者</p>
<p>Publisher：发布者</p>
<p>Channel：频道</p>
<h3 id="5-2-2：订阅者监听频道"><a href="#5-2-2：订阅者监听频道" class="headerlink" title="5.2.2：订阅者监听频道"></a>5.2.2：订阅者监听频道</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># redis-cli </span></span><br><span class="line">127.0.0.1:6379&gt; AUTH 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE channel1  <span class="comment">#订阅者订阅指定的频道</span></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">"subscribe"</span></span><br><span class="line">2) <span class="string">"channel1"</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<h3 id="5-2-3：发布者发布消息"><a href="#5-2-3：发布者发布消息" class="headerlink" title="5.2.3：发布者发布消息"></a>5.2.3：发布者发布消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; PUBLISH channel1 test1 <span class="comment">#发布者发布消息</span></span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH channel1 test2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-4：订阅多个频道"><a href="#5-2-4：订阅多个频道" class="headerlink" title="5.2.4：订阅多个频道"></a>5.2.4：订阅多个频道</h3><p>订阅指定的多个频道</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSCRIBE channel1 channel2</span><br></pre></td></tr></table></figure>
<h3 id="5-2-5：订阅所有频道"><a href="#5-2-5：订阅所有频道" class="headerlink" title="5.2.5：订阅所有频道"></a>5.2.5：订阅所有频道</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; PSUBSCRIBE *</span><br></pre></td></tr></table></figure>
<h3 id="5-2-6：订阅匹配的频道"><a href="#5-2-6：订阅匹配的频道" class="headerlink" title="5.2.6：订阅匹配的频道"></a>5.2.6：订阅匹配的频道</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSUBSCRIBE chann* <span class="comment">#匹配订阅多个频道</span></span><br></pre></td></tr></table></figure>
<h1 id="六：redis其他命令"><a href="#六：redis其他命令" class="headerlink" title="六：redis其他命令"></a>六：redis其他命令</h1><h2 id="6-1：查看当前redis配置、以及不重启更改redis配置等"><a href="#6-1：查看当前redis配置、以及不重启更改redis配置等" class="headerlink" title="6.1：查看当前redis配置、以及不重启更改redis配置等"></a>6.1：查看当前redis配置、以及不重启更改redis配置等</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG GET *</span><br></pre></td></tr></table></figure>
<h3 id="6-1-1：更改最大内存"><a href="#6-1-1：更改最大内存" class="headerlink" title="6.1.1：更改最大内存"></a>6.1.1：更改最大内存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; CONFIG <span class="built_in">set</span> maxmemory 8589934592</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG get maxmemory </span><br><span class="line">1) <span class="string">"maxmemory"</span></span><br><span class="line">2) <span class="string">"8589934592"</span></span><br></pre></td></tr></table></figure>
<h3 id="6-1-2：设置连接密码（临时有效）"><a href="#6-1-2：设置连接密码（临时有效）" class="headerlink" title="6.1.2：设置连接密码（临时有效）"></a>6.1.2：设置连接密码（临时有效）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; [root@centos7 ~]<span class="comment">#redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; CONFIG SET requirepass 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET requirepass</span><br><span class="line">(error) NOAUTH Authentication requirepass.</span><br><span class="line">127.0.0.1:6379&gt; AUTH 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET requirepass</span><br><span class="line">1) <span class="string">"requirepass"</span></span><br><span class="line">2) <span class="string">"123456"</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<h2 id="6-2：显示当前节点redis运行状态信息"><a href="#6-2：显示当前节点redis运行状态信息" class="headerlink" title="6.2：显示当前节点redis运行状态信息"></a>6.2：显示当前节点redis运行状态信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info</span><br></pre></td></tr></table></figure>
<h2 id="6-3：切换数据库"><a href="#6-3：切换数据库" class="headerlink" title="6.3：切换数据库"></a>6.3：切换数据库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SELECT 1</span><br><span class="line">ok</span><br><span class="line">127.0.0.1:6379[1]&gt;</span><br></pre></td></tr></table></figure>
<h2 id="6-4：查看当前库下的所有key"><a href="#6-4：查看当前库下的所有key" class="headerlink" title="6.4：查看当前库下的所有key"></a>6.4：查看当前库下的所有key</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br></pre></td></tr></table></figure>
<h2 id="6-5：手动在后台执行RDB持久化操作"><a href="#6-5：手动在后台执行RDB持久化操作" class="headerlink" title="6.5：手动在后台执行RDB持久化操作"></a>6.5：手动在后台执行RDB持久化操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;BGSAVE</span><br></pre></td></tr></table></figure>
<h2 id="6-6：返回当前库下的所有key-数量"><a href="#6-6：返回当前库下的所有key-数量" class="headerlink" title="6.6：返回当前库下的所有key 数量"></a>6.6：返回当前库下的所有key 数量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;DBSIZE</span><br></pre></td></tr></table></figure>
<h2 id="6-7：清空当前数据库"><a href="#6-7：清空当前数据库" class="headerlink" title="6.7：清空当前数据库"></a>6.7：清空当前数据库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;FLUSHDB</span><br></pre></td></tr></table></figure>
<h2 id="6-8：清空所有数据库"><a href="#6-8：清空所有数据库" class="headerlink" title="6.8：清空所有数据库"></a>6.8：清空所有数据库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;FLUSHALL</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

  <div style="text-align:center;color: #ccc;font-size:14px;">---------------- The End ----------------</div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="谢 佳 WeChat Pay">
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="谢 佳 Alipay">
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/redis/" rel="tag"><i class="fa fa-tag"></i> redis</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/05/企业级调度器LVS/" rel="next" title="企业级调度器LVS">
                <i class="fa fa-chevron-left"></i> 企业级调度器LVS
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/14/redis高可用与集群/" rel="prev" title="redis高可用与集群">
                redis高可用与集群 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.gif" alt="谢 佳">
            
              <p class="site-author-name" itemprop="name">谢 佳</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一：缓存概念"><span class="nav-number">1.</span> <span class="nav-text">一：缓存概念</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1：系统缓存"><span class="nav-number">1.1.</span> <span class="nav-text">1.1：系统缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-1：buffer与cache"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1.1：buffer与cache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-2：cache的保存位置"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.1.2：cache的保存位置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2：CDN缓存"><span class="nav-number">1.2.</span> <span class="nav-text">1.2：CDN缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1：CDN概念"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.2.1：CDN概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2：CDN主要优势"><span class="nav-number">1.2.2.</span> <span class="nav-text">1.2.2：CDN主要优势</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3：应用层缓存"><span class="nav-number">1.3.</span> <span class="nav-text">1.3：应用层缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4：其他层面缓存"><span class="nav-number">1.4.</span> <span class="nav-text">1.4：其他层面缓存</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二：redis部署"><span class="nav-number">2.</span> <span class="nav-text">二：redis部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1：redis简介："><span class="nav-number">2.0.1.</span> <span class="nav-text">2.1.1：redis简介：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2：redis对比memcached"><span class="nav-number">2.0.2.</span> <span class="nav-text">2.1.2：redis对比memcached</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3：redis-典型应用场景"><span class="nav-number">2.0.3.</span> <span class="nav-text">2.1.3：redis 典型应用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2：Redis安装及使用"><span class="nav-number">2.1.</span> <span class="nav-text">2.2：Redis安装及使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1：yum安装redis"><span class="nav-number">2.1.1.</span> <span class="nav-text">2.2.1：yum安装redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2：编译安装redis"><span class="nav-number">2.1.2.</span> <span class="nav-text">2.2.2：编译安装redis</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-1：编译安装命令"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">2.2.2.1：编译安装命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-2：前台启动redis"><span class="nav-number">2.1.2.2.</span> <span class="nav-text">2.2.2.2：前台启动redis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-3：解决当前的警告提示"><span class="nav-number">2.1.2.3.</span> <span class="nav-text">2.2.2.3：解决当前的警告提示</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-3-1：tcp-backlog"><span class="nav-number">2.1.2.3.1.</span> <span class="nav-text">2.2.2.3.1：tcp-backlog</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-3-2：vm-overcommit-memory"><span class="nav-number">2.1.2.3.2.</span> <span class="nav-text">2.2.2.3.2：vm.overcommit_memory</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-2-3-3：transparent-hugepage"><span class="nav-number">2.1.2.3.3.</span> <span class="nav-text">2.2.2.3.3：transparent hugepage</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-4：编辑redis服务启动脚本"><span class="nav-number">2.1.2.4.</span> <span class="nav-text">2.2.2.4：编辑redis服务启动脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-5：创建redis-用户和数据目录"><span class="nav-number">2.1.2.5.</span> <span class="nav-text">2.2.2.5：创建redis 用户和数据目录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-6：创建命令软连接"><span class="nav-number">2.1.2.6.</span> <span class="nav-text">2.2.2.6：创建命令软连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-7：重启redis服务"><span class="nav-number">2.1.2.7.</span> <span class="nav-text">2.2.2.7：重启redis服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-8：使用客户端连接redis"><span class="nav-number">2.1.2.8.</span> <span class="nav-text">2.2.2.8：使用客户端连接redis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-9：编译安装后的命令"><span class="nav-number">2.1.2.9.</span> <span class="nav-text">2.2.2.9：编译安装后的命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-3：连接到Redis"><span class="nav-number">2.1.3.</span> <span class="nav-text">2.2.3：连接到Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-1：本机非密码连接"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">2.2.3.1：本机非密码连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-2：跨主机非密码连接"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">2.2.3.2：跨主机非密码连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-3：跨主机密码连接"><span class="nav-number">2.1.3.3.</span> <span class="nav-text">2.2.3.3：跨主机密码连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-4：python连接方式"><span class="nav-number">2.1.3.4.</span> <span class="nav-text">2.2.3.4：python连接方式</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#三：redis配置文件"><span class="nav-number">3.</span> <span class="nav-text">三：redis配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1：网络配置项"><span class="nav-number">3.1.</span> <span class="nav-text">3.1：网络配置项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2：通用配置项"><span class="nav-number">3.2.</span> <span class="nav-text">3.2：通用配置项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3：快照配置项"><span class="nav-number">3.3.</span> <span class="nav-text">3.3：快照配置项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4：复制相关的配置"><span class="nav-number">3.4.</span> <span class="nav-text">3.4：复制相关的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5：安全相关配置"><span class="nav-number">3.5.</span> <span class="nav-text">3.5：安全相关配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6：Limit相关的配置"><span class="nav-number">3.6.</span> <span class="nav-text">3.6：Limit相关的配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-7：APPEND-ONLY-MODE"><span class="nav-number">3.7.</span> <span class="nav-text">3.7：APPEND ONLY MODE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-8：-LUA-SCRIPTING"><span class="nav-number">3.8.</span> <span class="nav-text">3.8： LUA SCRIPTING</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-9：-REDIS-CLUSTER"><span class="nav-number">3.9.</span> <span class="nav-text">3.9： REDIS CLUSTER</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-10：-SLOW-LOG"><span class="nav-number">3.10.</span> <span class="nav-text">3.10： SLOW LOG</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2：redis持久化"><span class="nav-number">3.11.</span> <span class="nav-text">3.2：redis持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1：RDB模式"><span class="nav-number">3.11.1.</span> <span class="nav-text">3.2.1：RDB模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2：RDB模式的优缺点"><span class="nav-number">3.11.2.</span> <span class="nav-text">3.2.2：RDB模式的优缺点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3：AOF模式"><span class="nav-number">3.11.3.</span> <span class="nav-text">3.2.3：AOF模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-4：AOF模式优缺点"><span class="nav-number">3.11.4.</span> <span class="nav-text">3.2.4：AOF模式优缺点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四：redis-数据类型"><span class="nav-number">4.</span> <span class="nav-text">四：redis 数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1：字符串-string"><span class="nav-number">4.1.</span> <span class="nav-text">4.1：字符串(string)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-1：添加一个key"><span class="nav-number">4.1.1.</span> <span class="nav-text">4.1.1：添加一个key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-2：获取一个key的内容"><span class="nav-number">4.1.2.</span> <span class="nav-text">4.1.2：获取一个key的内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-3：删除一个key"><span class="nav-number">4.1.3.</span> <span class="nav-text">4.1.3：删除一个key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-4：批量设置多个key"><span class="nav-number">4.1.4.</span> <span class="nav-text">4.1.4：批量设置多个key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-5：批量获取多个key"><span class="nav-number">4.1.5.</span> <span class="nav-text">4.1.5：批量获取多个key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-6：追加数据"><span class="nav-number">4.1.6.</span> <span class="nav-text">4.1.6：追加数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-7：数值递增"><span class="nav-number">4.1.7.</span> <span class="nav-text">4.1.7：数值递增</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-8：数值递减"><span class="nav-number">4.1.8.</span> <span class="nav-text">4.1.8：数值递减</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-9：返回字符串key长度"><span class="nav-number">4.1.9.</span> <span class="nav-text">4.1.9：返回字符串key长度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2：列表-list"><span class="nav-number">4.2.</span> <span class="nav-text">4.2：列表(list)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1：生成列表并插入数据"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.2.1：生成列表并插入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2：向列表追加数据"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.2.2：向列表追加数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3：获取列表长度"><span class="nav-number">4.2.3.</span> <span class="nav-text">4.2.3：获取列表长度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4：移除列表数据"><span class="nav-number">4.2.4.</span> <span class="nav-text">4.2.4：移除列表数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3：集合-set"><span class="nav-number">4.3.</span> <span class="nav-text">4.3：集合(set)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-1：生成集合key"><span class="nav-number">4.3.1.</span> <span class="nav-text">4.3.1：生成集合key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-2：追加数值"><span class="nav-number">4.3.2.</span> <span class="nav-text">4.3.2：追加数值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3：查看集合的所有数据"><span class="nav-number">4.3.3.</span> <span class="nav-text">4.3.3：查看集合的所有数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4：获取集合的差集"><span class="nav-number">4.3.4.</span> <span class="nav-text">4.2.4：获取集合的差集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-5：获取集合的交集"><span class="nav-number">4.3.5.</span> <span class="nav-text">4.3.5：获取集合的交集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-6：获取集合的并集"><span class="nav-number">4.3.6.</span> <span class="nav-text">4.3.6：获取集合的并集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4：sorted-set-有序集合"><span class="nav-number">4.4.</span> <span class="nav-text">4.4：sorted set(有序集合)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-1：生成有序集合"><span class="nav-number">4.4.1.</span> <span class="nav-text">4.4.1：生成有序集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-2：批量添加多个数值"><span class="nav-number">4.4.2.</span> <span class="nav-text">4.4.2：批量添加多个数值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-3：获取集合的长度数"><span class="nav-number">4.4.3.</span> <span class="nav-text">4.4.3：获取集合的长度数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-4：基于索引返回数值"><span class="nav-number">4.4.4.</span> <span class="nav-text">4.4.4：基于索引返回数值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-5：返回某个数值的索引"><span class="nav-number">4.4.5.</span> <span class="nav-text">4.4.5：返回某个数值的索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5：哈希-hash"><span class="nav-number">4.5.</span> <span class="nav-text">4.5：哈希(hash)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-1：生成hash-key"><span class="nav-number">4.5.1.</span> <span class="nav-text">4.5.1：生成hash key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-2：获取hash-key字段值"><span class="nav-number">4.5.2.</span> <span class="nav-text">4.5.2：获取hash key字段值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-3：删除一个hash-key的字段"><span class="nav-number">4.5.3.</span> <span class="nav-text">4.5.3：删除一个hash key的字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-4：获取所有hash表中的字段"><span class="nav-number">4.5.4.</span> <span class="nav-text">4.5.4：获取所有hash表中的字段</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五：消息队列"><span class="nav-number">5.</span> <span class="nav-text">五：消息队列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1：生产者消费者模式"><span class="nav-number">5.1.</span> <span class="nav-text">5.1：生产者消费者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-1：模式介绍"><span class="nav-number">5.1.1.</span> <span class="nav-text">5.1.1：模式介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-2：队列介绍"><span class="nav-number">5.1.2.</span> <span class="nav-text">5.1.2：队列介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-3：生产者发布消息"><span class="nav-number">5.1.3.</span> <span class="nav-text">5.1.3：生产者发布消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-4：查看队列所有消息"><span class="nav-number">5.1.4.</span> <span class="nav-text">5.1.4：查看队列所有消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-5：消费者消费消息"><span class="nav-number">5.1.5.</span> <span class="nav-text">5.1.5：消费者消费消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-6：再次验证队列消息"><span class="nav-number">5.1.6.</span> <span class="nav-text">5.1.6：再次验证队列消息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2：发布者订阅模式"><span class="nav-number">5.2.</span> <span class="nav-text">5.2：发布者订阅模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-1：模式简介"><span class="nav-number">5.2.1.</span> <span class="nav-text">5.2.1：模式简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-2：订阅者监听频道"><span class="nav-number">5.2.2.</span> <span class="nav-text">5.2.2：订阅者监听频道</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-3：发布者发布消息"><span class="nav-number">5.2.3.</span> <span class="nav-text">5.2.3：发布者发布消息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-4：订阅多个频道"><span class="nav-number">5.2.4.</span> <span class="nav-text">5.2.4：订阅多个频道</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-5：订阅所有频道"><span class="nav-number">5.2.5.</span> <span class="nav-text">5.2.5：订阅所有频道</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-6：订阅匹配的频道"><span class="nav-number">5.2.6.</span> <span class="nav-text">5.2.6：订阅匹配的频道</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#六：redis其他命令"><span class="nav-number">6.</span> <span class="nav-text">六：redis其他命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1：查看当前redis配置、以及不重启更改redis配置等"><span class="nav-number">6.1.</span> <span class="nav-text">6.1：查看当前redis配置、以及不重启更改redis配置等</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-1：更改最大内存"><span class="nav-number">6.1.1.</span> <span class="nav-text">6.1.1：更改最大内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-2：设置连接密码（临时有效）"><span class="nav-number">6.1.2.</span> <span class="nav-text">6.1.2：设置连接密码（临时有效）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2：显示当前节点redis运行状态信息"><span class="nav-number">6.2.</span> <span class="nav-text">6.2：显示当前节点redis运行状态信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3：切换数据库"><span class="nav-number">6.3.</span> <span class="nav-text">6.3：切换数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-4：查看当前库下的所有key"><span class="nav-number">6.4.</span> <span class="nav-text">6.4：查看当前库下的所有key</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-5：手动在后台执行RDB持久化操作"><span class="nav-number">6.5.</span> <span class="nav-text">6.5：手动在后台执行RDB持久化操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-6：返回当前库下的所有key-数量"><span class="nav-number">6.6.</span> <span class="nav-text">6.6：返回当前库下的所有key 数量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-7：清空当前数据库"><span class="nav-number">6.7.</span> <span class="nav-text">6.7：清空当前数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-8：清空所有数据库"><span class="nav-number">6.8.</span> <span class="nav-text">6.8：清空所有数据库</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">谢 佳</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">88.7k</span>
  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  


<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>